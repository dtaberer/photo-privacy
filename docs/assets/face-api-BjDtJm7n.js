import{w as st,_ as E,Z as F,H as yt,a as Nt,Y as it,C as J,b as G,c as y,d as w,i as me,O as ir,P as Dt,x as sn,e as cr,S as Ze,F as un,J as sr,r as T,B,q as Ft,L as xt,M as V,f as ur,g as I,h as qt,j as hr,k as At,U as z,l as R,m as Q,W as Pt,G as se,n as hn,o as fr,p as fn,s as vn,t as mt,u as ln,I as pn,v as Ke,y as dt,z as Qe,A as vr,D as tr,E as Zt,K as ge}from"./vendor-C3Tnp9W3.js";import{N as Xo}from"./vendor-C3Tnp9W3.js";import"./react-vendor-PxcwVTN2.js";function pt(r,t,e){if(e===void 0&&(e=!1),r.beginPath(),t.slice(1).forEach(function(o,c){var i=o.x,s=o.y,u=t[c];r.moveTo(u.x,u.y),r.lineTo(i,s)}),e){var n=t[t.length-1],a=t[0];if(!n||!a)return;r.moveTo(n.x,n.y),r.lineTo(a.x,a.y)}r.stroke()}var wt=(function(){function r(t,e){if(!gt(t)||!gt(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r})();function Bt(r,t){return r instanceof st&&r.shape.length===t}function dn(r){return Bt(r,1)}function lr(r){return Bt(r,2)}function Rt(r){return Bt(r,3)}function ct(r){return Bt(r,4)}function pr(r){return r%1!==0}function ve(r){return r%2===0}function Kt(r,t){t===void 0&&(t=2);var e=Math.pow(10,t);return Math.floor(r*e)/e}function le(r){return r&&r.width&&r.height}function dr(r,t){var e=r.width,n=r.height,a=t/Math.max(n,e);return new wt(Math.round(e*a),Math.round(n*a))}function Qt(r){return r.reduce(function(t,e){return t.add(e)},new C(0,0)).div(new C(r.length,r.length))}function Ct(r,t,e){return Array(r).fill(0).map(function(n,a){return t+a*e})}function gt(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function Ut(r){return gt(r)&&0<=r&&r<=1}const io=Object.freeze(Object.defineProperty({__proto__:null,computeReshapedDimensions:dr,getCenterPoint:Qt,isDimensions:le,isEven:ve,isFloat:pr,isTensor:Bt,isTensor1D:dn,isTensor2D:lr,isTensor3D:Rt,isTensor4D:ct,isValidNumber:gt,isValidProbablitiy:Ut,range:Ct,round:Kt},Symbol.toStringTag,{value:"Module"}));var C=(function(){function r(t,e){this._x=t,this._y=e}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.sub=function(t){return new r(this.x-t.x,this.y-t.y)},r.prototype.mul=function(t){return new r(this.x*t.x,this.y*t.y)},r.prototype.div=function(t){return new r(this.x/t.x,this.y/t.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r})(),et=(function(){function r(t,e){e===void 0&&(e=!0);var n=t||{},a=[n.left,n.top,n.right,n.bottom].every(gt),o=[n.x,n.y,n.width,n.height].every(gt);if(!o&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var c=o?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],i=c[0],s=c[1],u=c[2],h=c[3];r.assertIsValidBox({x:i,y:s,width:u,height:h},"Box.constructor",e),this._x=i,this._y=s,this._width=u,this._height=h}return r.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(gt)},r.assertIsValidBox=function(t,e,n){if(n===void 0&&(n=!1),!r.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!n&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new C(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new C(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new C(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new C(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(c){return Math.round(c)}),e=t[0],n=t[1],a=t[2],o=t[3];return new r({x:e,y:n,width:a,height:o})},r.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(c){return Math.floor(c)}),e=t[0],n=t[1],a=t[2],o=t[3];return new r({x:e,y:n,width:a,height:o})},r.prototype.toSquare=function(){var t=this,e=t.x,n=t.y,a=t.width,o=t.height,c=Math.abs(a-o);return a<o&&(e-=c/2,a+=c),o<a&&(n-=c/2,o+=c),new r({x:e,y:n,width:a,height:o})},r.prototype.rescale=function(t){var e=le(t)?t.width:t,n=le(t)?t.height:t;return new r({x:this.x*e,y:this.y*n,width:this.width*e,height:this.height*n})},r.prototype.pad=function(t,e){var n=[this.x-t/2,this.y-e/2,this.width+t,this.height+e],a=n[0],o=n[1],c=n[2],i=n[3];return new r({x:a,y:o,width:c,height:i})},r.prototype.clipAtImageBorders=function(t,e){var n=this,a=n.x,o=n.y,c=n.right,i=n.bottom,s=Math.max(a,0),u=Math.max(o,0),h=c-s,f=i-u,v=Math.min(h,t-s),l=Math.min(f,e-u);return new r({x:s,y:u,width:v,height:l}).floor()},r.prototype.shift=function(t,e){var n=this,a=n.width,o=n.height,c=this.x+t,i=this.y+e;return new r({x:c,y:i,width:a,height:o})},r.prototype.padAtBorders=function(t,e){var n=this.width+1,a=this.height+1,o=1,c=1,i=n,s=a,u=this.left,h=this.top,f=this.right,v=this.bottom;return f>e&&(i=-f+e+n,f=e),v>t&&(s=-v+t+a,v=t),u<1&&(s=2-u,u=1),h<1&&(s=2-h,h=1),{dy:c,edy:s,dx:o,edx:i,y:h,ey:v,x:u,ex:f,w:n,h:a}},r.prototype.calibrate=function(t){return new r({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},r})(),te=(function(r){E(t,r);function t(e,n,a,o,c){return c===void 0&&(c=!1),r.call(this,{left:e,top:n,right:a,bottom:o},c)||this}return t})(et),mr=(function(){function r(t,e,n,a,o){this._imageDims=new wt(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new et(a).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new et(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(t,e){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},r})(),Y=(function(r){E(t,r);function t(e,n,a){return r.call(this,e,e,"",n,a)||this}return t.prototype.forSize=function(e,n){var a=r.prototype.forSize.call(this,e,n),o=a.score,c=a.relativeBox,i=a.imageDims;return new t(o,c,i)},t})(mr);function mn(r,t,e){e===void 0&&(e=!0);var n=Math.max(0,Math.min(r.right,t.right)-Math.max(r.left,t.left)),a=Math.max(0,Math.min(r.bottom,t.bottom)-Math.max(r.top,t.top)),o=n*a;return e?o/(r.area+t.area-o):o/Math.min(r.area,t.area)}function gn(r){var t=r.map(function(i){return i.x}),e=r.map(function(i){return i.y}),n=t.reduce(function(i,s){return s<i?s:i},1/0),a=e.reduce(function(i,s){return s<i?s:i},1/0),o=t.reduce(function(i,s){return i<s?s:i},0),c=e.reduce(function(i,s){return i<s?s:i},0);return new te(n,a,o,c)}function It(r,t,e,n){n===void 0&&(n=!0);for(var a=t.map(function(i,s){return{score:i,boxIndex:s}}).sort(function(i,s){return i.score-s.score}).map(function(i){return i.boxIndex}),o=[],c=function(){var i=a.pop();o.push(i);for(var s=a,u=[],h=0;h<s.length;h++){var f=s[h],v=r[i],l=r[f];u.push(mn(v,l,n))}a=a.filter(function(p,m){return u[m]<=e})};a.length>0;)c();return o}function jt(r,t){return F(function(){var e=t[0],n=t[1],a=t[2],o=yt(Nt(r.shape.slice(0,3),[1]),e),c=yt(Nt(r.shape.slice(0,3),[1]),n),i=yt(Nt(r.shape.slice(0,3),[1]),a),s=it([o,c,i],3);return J(r,s)})}function _n(r,t){return t===void 0&&(t=!1),F(function(){var e=r.shape.slice(1),n=e[0],a=e[1];if(n===a)return r;var o=Math.abs(n-a),c=Math.round(o*(t?.5:1)),i=n>a?2:1,s=function(l){var p=r.shape.slice();return p[i]=l,yt(p,0)},u=s(c),h=o-u.shape[i],f=t&&h?s(h):null,v=[f,r,u].filter(function(l){return!!l}).map(function(l){return l.toFloat()});return it(v,i)})}function co(r){for(var t=r.slice(),e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),a=t[e];t[e]=t[n],t[n]=a}return t}function ue(r){return 1/(1+Math.exp(-r))}function so(r){return Math.log(r/(1-r))}var _e=(function(r){E(t,r);function t(e,n,a,o,c){return c===void 0&&(c=!1),r.call(this,{x:e,y:n,width:a,height:o},c)||this}return t})(et),bn=.5,yn=.43,wn=.45,St=(function(){function r(t,e,n){n===void 0&&(n=new C(0,0));var a=e.width,o=e.height;this._imgDims=new wt(a,o),this._shift=n,this._positions=t.map(function(c){return c.mul(new C(a,o)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new C(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new C(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},r.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new C(t,e))},r.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},r.prototype.align=function(t,e){if(e===void 0&&(e={}),t){var n=t instanceof Y?t.box.floor():new et(t);return this.shiftBy(n.x,n.y).align(null,e)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=a.useDlibAlignment,c=a.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(c)},r.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],a=t[2],o=function(f){return a.sub(f).magnitude()},c=(o(e)+o(n))/2,i=Math.floor(c/wn),s=Qt(t),u=Math.floor(Math.max(0,s.x-bn*i)),h=Math.floor(Math.max(0,s.y-yn*i));return new _e(u,h,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+h))},r.prototype.alignMinBbox=function(t){var e=gn(this.positions);return e.pad(e.width*t,e.height*t)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r})(),xn=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],Qt([e[3],e[4]])]},t})(St),gr=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Qt)},t})(St),er=(function(){function r(t,e){this._label=t,this._distance=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+Kt(this.distance)+")":"")},r})(),rr=(function(r){E(t,r);function t(e,n){var a=r.call(this,e)||this;return a._label=n,a}return t.assertIsValidLabeledBox=function(e,n){if(et.assertIsValidBox(e,n),!gt(e.label))throw new Error(n+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t})(et),Ht=(function(){function r(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},r.fromJSON=function(t){var e=t.descriptors.map(function(n){return new Float32Array(n)});return new r(t.label,e)},r})(),uo=(function(r){E(t,r);function t(e,n,a,o){var c=r.call(this,e,n)||this;return c._score=a,c._classScore=o,c}return t.assertIsValidPredictedBox=function(e,n){if(rr.assertIsValidLabeledBox(e,n),!Ut(e.score)||!Ut(e.classScore))throw new Error(n+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(rr);function Ot(r){return r.detection instanceof Y}function Wt(r,t){var e={detection:t};return Object.assign({},r,e)}function _r(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:t}}function br(r){var t="";if(!r)try{r=require("fs")}catch(n){t=n.toString()}var e=r?function(n){return new Promise(function(a,o){r.readFile(n,function(c,i){return c?o(c):a(i)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:e}}function yr(){var r=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,e=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=br();return G({Canvas:r||(function(){function c(){}return c})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function c(){}return c})(),Image:t||(function(){function c(){}return c})(),ImageData:global.ImageData||(function(){function c(){}return c})(),Video:global.HTMLVideoElement||(function(){function c(){}return c})(),createCanvasElement:e,createImageElement:n,fetch:a},o)}function wr(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function xr(){return typeof global=="object"&&typeof require=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var N;function Pn(){if(!N)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return N}function pe(r){N=r}function be(){wr()&&pe(_r()),xr()&&pe(yr())}function Fn(r){if(N||be(),!N)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=r.Canvas,e=t===void 0?N.Canvas:t,n=r.Image,a=n===void 0?N.Image:n;N.Canvas=e,N.Image=a,N.createCanvasElement=r.createCanvasElement||(function(){return new e}),N.createImageElement=r.createImageElement||(function(){return new a}),N.ImageData=r.ImageData||N.ImageData,N.Video=r.Video||N.Video,N.fetch=r.fetch||N.fetch,N.readFile=r.readFile||N.readFile}var j={getEnv:Pn,setEnv:pe,initialize:be,createBrowserEnv:_r,createFileSystem:br,createNodejsEnv:yr,monkeyPatch:Fn,isBrowser:wr,isNodejs:xr};be();function ye(r){return!j.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function rt(r){var t=j.getEnv(),e=t.Canvas,n=t.CanvasRenderingContext2D;if(r instanceof n)return r;var a=ye(r);if(!(a instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=a.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var ot;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})(ot||(ot={}));var we=(function(){function r(t){t===void 0&&(t={});var e=t.anchorPosition,n=t.backgroundColor,a=t.fontColor,o=t.fontSize,c=t.fontStyle,i=t.padding;this.anchorPosition=e||ot.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=c||"Georgia",this.padding=i||4}return r})(),xe=(function(){function r(t,e,n){n===void 0&&(n={}),this.text=typeof t=="string"?[t]:t instanceof r?t.text:t,this.anchor=e,this.options=new we(n)}return r.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(n){return t.measureText(n).width}).reduce(function(n,a){return n<a?a:n},0)+2*e},r.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},r.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,a=n===ot.BOTTOM_RIGHT||n===ot.TOP_RIGHT,o=n===ot.BOTTOM_LEFT||n===ot.BOTTOM_RIGHT,c=this.measureWidth(t),i=this.measureHeight(),s=a?this.anchor.x-c:this.anchor.x,u=o?this.anchor.y-i:this.anchor.y;if(e){var h=e.width,f=e.height,v=Math.max(Math.min(s,h-c),0),l=Math.max(Math.min(u,f-i),0);return{x:v,y:l}}return{x:s,y:u}},r.prototype.draw=function(t){var e=ye(t),n=rt(e),a=this.options,o=a.backgroundColor,c=a.fontColor,i=a.fontSize,s=a.fontStyle,u=a.padding;n.font=i+"px "+s;var h=this.measureWidth(n),f=this.measureHeight();n.fillStyle=o;var v=this.getUpperLeft(n,e);n.fillRect(v.x,v.y,h,f),n.fillStyle=c,this.text.forEach(function(l,p){var m=u+v.x,g=u+v.y+(p+1)*i;n.fillText(l,m,g)})},r})(),Pr=(function(){function r(t){t===void 0&&(t={});var e=t.boxColor,n=t.lineWidth,a=t.label,o=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=a;var c={anchorPosition:ot.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new we(Object.assign({},c,o))}return r})(),Fr=(function(){function r(t,e){e===void 0&&(e={}),this.box=new et(t),this.options=new Pr(e)}return r.prototype.draw=function(t){var e=rt(t),n=this.options,a=n.boxColor,o=n.lineWidth,c=this.box,i=c.x,s=c.y,u=c.width,h=c.height;e.strokeStyle=a,e.lineWidth=o,e.strokeRect(i,s,u,h);var f=this.options.label;f&&new xe([f],{x:i-o/2,y:s},this.options.drawLabelOptions).draw(t)},r})();function En(r,t){var e=Array.isArray(t)?t:[t];e.forEach(function(n){var a=n instanceof Y?n.score:Ot(n)?n.detection.score:void 0,o=n instanceof Y?n.box:Ot(n)?n.detection.box:new et(n),c=a?""+Kt(a):void 0;new Fr(o,{label:c}).draw(r)})}function Er(r){var t=j.getEnv(),e=t.Image,n=t.Video;return r instanceof e&&r.complete||r instanceof n&&r.readyState>=3}function Mn(r){return new Promise(function(t,e){if(r instanceof j.getEnv().Canvas||Er(r))return t();function n(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",n),o.currentTarget.removeEventListener("error",a),t(o))}function a(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",n),o.currentTarget.removeEventListener("error",a),e(o))}r.addEventListener("load",n),r.addEventListener("error",a)})}function Dn(r){return new Promise(function(t,e){if(!(r instanceof Blob))return e("bufferToImage - expected buf to be of type: Blob");var n=new FileReader;n.onload=function(){if(typeof n.result!="string")return e("bufferToImage - expected reader.result to be a string, in onload");var a=j.getEnv().createImageElement();a.onload=function(){return t(a)},a.onerror=e,a.src=n.result},n.onerror=e,n.readAsDataURL(r)})}function Pe(r){var t=j.getEnv(),e=t.Image,n=t.Video;return r instanceof e?new wt(r.naturalWidth,r.naturalHeight):r instanceof n?new wt(r.videoWidth,r.videoHeight):new wt(r.width,r.height)}function ee(r){var t=r.width,e=r.height,n=j.getEnv().createCanvasElement,a=n();return a.width=t,a.height=e,a}function Fe(r,t){var e=j.getEnv().ImageData;if(!(r instanceof e)&&!Er(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=t||Pe(r),a=n.width,o=n.height,c=ee({width:a,height:o});return r instanceof e?rt(c).putImageData(r,0,0):rt(c).drawImage(r,0,0,a,o),c}function Tn(r,t){return y(this,void 0,void 0,function(){var e,n,a,o,c,i;return w(this,function(s){switch(s.label){case 0:return e=t||j.getEnv().createCanvasElement(),n=r.shape.slice(ct(r)?1:0),a=n[0],o=n[1],c=n[2],i=F(function(){return r.as3D(a,o,c).toInt()}),[4,me.toPixels(i,e)];case 1:return s.sent(),i.dispose(),[2,e]}})})}function nr(r){var t=j.getEnv(),e=t.Image,n=t.Canvas,a=t.Video;return r instanceof e||r instanceof n||r instanceof a}function Cn(r,t,e){e===void 0&&(e=!1);var n=j.getEnv(),a=n.Image,o=n.Canvas;if(!(r instanceof a||r instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var c=Pe(r),i=t/Math.max(c.height,c.width),s=i*c.width,u=i*c.height,h=ee({width:t,height:t}),f=r instanceof o?r:Fe(r),v=Math.abs(s-u)/2,l=e&&s<u?v:0,p=e&&u<s?v:0;return rt(h).drawImage(f,l,p,s,u),h}var Jt=(function(){function r(t,e){var n=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(a,o){if(Rt(a)){n._imageTensors[o]=a,n._inputDimensions[o]=a.shape;return}if(ct(a)){var c=a.shape[0];if(c!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+c+" passed, but not supported in input array");n._imageTensors[o]=a,n._inputDimensions[o]=a.shape.slice(1);return}var i=a instanceof j.getEnv().Canvas?a:Fe(a);n._canvases[o]=i,n._inputDimensions[o]=[i.height,i.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var t=this;return Ct(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},r.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},r.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},r.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},r.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(t),n=this.getInputHeight(t);return dr({width:e,height:n},this.inputSize)},r.prototype.toBatchTensor=function(t,e){var n=this;return e===void 0&&(e=!0),this._inputSize=t,F(function(){var a=Ct(n.batchSize,0,1).map(function(c){var i=n.getInput(c);if(i instanceof st){var s=ct(i)?i:i.expandDims();return s=_n(s,e),(s.shape[1]!==t||s.shape[2]!==t)&&(s=ir.resizeBilinear(s,[t,t])),s.as3D(t,t,3)}if(i instanceof j.getEnv().Canvas)return me.fromPixels(Cn(i,t,e));throw new Error("toBatchTensor - at batchIdx "+c+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)}),o=Dt(a.map(function(c){return c.toFloat()})).as4D(n.batchSize,t,t,3);return o})},r})();function W(r){return y(this,void 0,void 0,function(){var t,e,n;return w(this,function(a){switch(a.label){case 0:if(r instanceof Jt)return[2,r];if(t=Array.isArray(r)?r:[r],!t.length)throw new Error("toNetInput - empty array passed as input");return e=function(o){return Array.isArray(r)?" at input index "+o+":":""},n=t.map(ye),n.forEach(function(o,c){if(!nr(o)&&!Rt(o)&&!ct(o))throw typeof t[c]=="string"?new Error("toNetInput -"+e(c)+" string passed, but could not resolve HTMLElement for element id "+t[c]):new Error("toNetInput -"+e(c)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ct(o)){var i=o.shape[0];if(i!==1)throw new Error("toNetInput -"+e(c)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(o){return nr(o)&&Mn(o)}))];case 1:return a.sent(),[2,new Jt(n,Array.isArray(r))]}})})}function Ee(r,t){return y(this,void 0,void 0,function(){var e,n,a,o,c,i,s;return w(this,function(u){switch(u.label){case 0:return e=j.getEnv().Canvas,n=r,r instanceof e?[3,5]:[4,W(r)];case 1:if(a=u.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=a.getInput(0),o instanceof e?(c=o,[3,4]):[3,2];case 2:return[4,Tn(o)];case 3:c=u.sent(),u.label=4;case 4:n=c,u.label=5;case 5:return i=rt(n),s=t.map(function(h){return h instanceof Y?h.forSize(n.width,n.height).box.floor():h}).map(function(h){return h.clipAtImageBorders(n.width,n.height)}),[2,s.map(function(h){var f=h.x,v=h.y,l=h.width,p=h.height,m=ee({width:l,height:p});return rt(m).putImageData(i.getImageData(f,v,l,p),0,0),m})]}})})}function Me(r,t){return y(this,void 0,void 0,function(){return w(this,function(e){if(!Rt(r)&&!ct(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ct(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,F(function(){var n=r.shape.slice(ct(r)?1:0),a=n[0],o=n[1],c=n[2],i=t.map(function(u){return u instanceof Y?u.forSize(o,a).box:u}).map(function(u){return u.clipAtImageBorders(o,a)}),s=i.map(function(u){var h=u.x,f=u.y,v=u.width,l=u.height;return sn(r.as3D(a,o,c),[f,h,0],[l,v,c])});return s})]})})}function De(r,t){return y(this,void 0,void 0,function(){var e,n;return w(this,function(a){switch(a.label){case 0:return e=j.getEnv().fetch,[4,e(r,t)];case 1:if(n=a.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function ho(r){return y(this,void 0,void 0,function(){var t,e;return w(this,function(n){switch(n.label){case 0:return[4,De(r)];case 1:return t=n.sent(),[4,t.blob()];case 2:if(e=n.sent(),!e.type.startsWith("image/"))throw new Error("fetchImage - expected blob type to be of type image/*, instead have: "+e.type+", for url: "+t.url);return[2,Dn(e)]}})})}function Sn(r){return y(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,De(r)];case 1:return[2,t.sent().json()]}})})}function fo(r){return y(this,void 0,void 0,function(){var t;return w(this,function(e){switch(e.label){case 0:return t=Float32Array.bind,[4,De(r)];case 1:return[4,e.sent().arrayBuffer()];case 2:return[2,new(t.apply(Float32Array,[void 0,e.sent()]))]}})})}function Mr(r,t){var e=t+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:e};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var a=r.split("/").filter(function(i){return i}),o=r.endsWith(".json")?a[a.length-1]:e,c=n+(r.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return c=r.startsWith("/")?"/"+c:c,{modelBaseUri:c,manifestUri:c==="/"?"/"+o:c+"/"+o}}function kn(r,t){return y(this,void 0,void 0,function(){var e,n,a,o;return w(this,function(c){switch(c.label){case 0:return e=Mr(r,t),n=e.manifestUri,a=e.modelBaseUri,[4,Sn(n)];case 1:return o=c.sent(),[2,cr.loadWeights(o,a)]}})})}function vo(r,t,e){e===void 0&&(e=!1);var n=e?Pe(t):t,a=n.width,o=n.height;return r.width=a,r.height=o,{width:a,height:o}}var ut=(function(){function r(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t),n=e.obj,a=e.objProp;return n[a]},r.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),a=n.obj,o=n.objProp;a[o].dispose(),a[o]=e},r.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Ze})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Ze)})},r.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,a=e.tensor;t.reassignParamFromPath(n,a.variable())})},r.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,a=e.tensor,o=un(a.dataSync());a.dispose(),t.reassignParamFromPath(n,o)})},r.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},r.prototype.load=function(t){return y(this,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},r.prototype.loadFromUri=function(t){return y(this,void 0,void 0,function(){var e;return w(this,function(n){switch(n.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,kn(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},r.prototype.loadFromDisk=function(t){return y(this,void 0,void 0,function(){var e,n,a,o,c,i,s,u,h,f;return w(this,function(v){switch(v.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=j.getEnv().readFile,n=Mr(t,this.getDefaultModelName()),a=n.manifestUri,o=n.modelBaseUri,c=function(l){return Promise.all(l.map(function(p){return e(p).then(function(m){return m.buffer})}))},i=cr.weightsLoaderFactory(c),h=(u=JSON).parse,[4,e(a)];case 1:return s=h.apply(u,[v.sent().toString()]),[4,i(s,o)];case 2:return f=v.sent(),this.loadFromWeightMap(f),[2]}})})},r.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,a=e.params;this._paramMappings=n,this._params=a},r.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,a=e.params;this._paramMappings=n,this._params=a},r.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(o,c){if(!o.nextObj.hasOwnProperty(c))throw new Error("traversePropertyPath - object does not have property "+c+", for path "+t);return{obj:o.nextObj,objProp:c,nextObj:o.nextObj[c]}},{nextObj:this.params}),n=e.obj,a=e.objProp;if(!n||!a||!(n[a]instanceof st))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:a}},r})();function $(r,t,e){return F(function(){var n=sr(r,t.depthwise_filter,t.pointwise_filter,e,"same");return n=T(n,t.bias),n})}function he(r,t,e){return e===void 0&&(e=!1),F(function(){var n=B(e?T(Ft(r,t.conv0.filters,[2,2],"same"),t.conv0.bias):$(r,t.conv0,[2,2])),a=$(n,t.conv1,[1,1]),o=B(T(n,a)),c=$(o,t.conv2,[1,1]);return B(T(n,T(a,c)))})}function Gt(r,t,e,n){return e===void 0&&(e=!1),n===void 0&&(n=!0),F(function(){var a=B(e?T(Ft(r,t.conv0.filters,n?[2,2]:[1,1],"same"),t.conv0.bias):$(r,t.conv0,n?[2,2]:[1,1])),o=$(a,t.conv1,[1,1]),c=B(T(a,o)),i=$(c,t.conv2,[1,1]),s=B(T(a,T(o,i))),u=$(s,t.conv3,[1,1]);return B(T(a,T(o,T(i,u))))})}function q(r,t,e,n){return e===void 0&&(e="same"),n===void 0&&(n=!1),F(function(){var a=T(Ft(r,t.filters,[1,1],e),t.bias);return n?B(a):a})}function ht(r,t){Object.keys(r).forEach(function(e){t.some(function(n){return n.originalPath===e})||r[e].dispose()})}function re(r,t){return function(e,n,a,o){var c=xt(r(e*n*a*a),[a,a,e,n]),i=V(r(n));return t.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:c,bias:i}}}function Te(r,t){return function(e,n,a){var o=ur(r(e*n),[e,n]),c=V(r(n));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:o,bias:c}}}var Dr=(function(){function r(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n}return r})();function Ce(r,t){return function(e,n,a){var o=xt(r(9*e),[3,3,e,1]),c=xt(r(e*n),[1,1,e,n]),i=V(r(n));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new Dr(o,c,i)}}function Se(r){return function(t){var e=r(t+"/depthwise_filter",4),n=r(t+"/pointwise_filter",4),a=r(t+"/bias",1);return new Dr(e,n,a)}}function _t(r,t){return function(e,n,a){var o=r[e];if(!Bt(o,n))throw new Error("expected weightMap["+e+"] to be a Tensor"+n+"D, instead have "+o);return t.push({originalPath:e,paramPath:a||e}),o}}function ft(r){var t=r;function e(a){var o=t.slice(0,a);return t=t.slice(a),o}function n(){return t}return{extractWeights:e,getRemainingWeights:n}}function Tr(r,t){var e=re(r,t),n=Ce(r,t);function a(c,i,s,u){u===void 0&&(u=!1);var h=u?e(c,i,3,s+"/conv0"):n(c,i,s+"/conv0"),f=n(i,i,s+"/conv1"),v=n(i,i,s+"/conv2");return{conv0:h,conv1:f,conv2:v}}function o(c,i,s,u){u===void 0&&(u=!1);var h=a(c,i,s,u),f=h.conv0,v=h.conv1,l=h.conv2,p=n(i,i,s+"/conv3");return{conv0:f,conv1:v,conv2:l,conv3:p}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:o}}function An(r){var t=[],e=ft(r),n=e.extractWeights,a=e.getRemainingWeights,o=Tr(n,t).extractDenseBlock4Params,c=o(3,32,"dense0",!0),i=o(32,64,"dense1"),s=o(64,128,"dense2"),u=o(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:c,dense1:i,dense2:s,dense3:u}}}function Cr(r){return function(t){var e=r(t+"/filters",4),n=r(t+"/bias",1);return{filters:e,bias:n}}}function Sr(r,t){var e=_t(r,t),n=Cr(e),a=Se(e);function o(i,s){s===void 0&&(s=!1);var u=s?n(i+"/conv0"):a(i+"/conv0"),h=a(i+"/conv1"),f=a(i+"/conv2");return{conv0:u,conv1:h,conv2:f}}function c(i,s){s===void 0&&(s=!1);var u=s?n(i+"/conv0"):a(i+"/conv0"),h=a(i+"/conv1"),f=a(i+"/conv2"),v=a(i+"/conv3");return{conv0:u,conv1:h,conv2:f,conv3:v}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:c}}function Bn(r){var t=[],e=Sr(r,t).extractDenseBlock4Params,n={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return ht(r,t),{params:n,paramMappings:t}}var kr=(function(r){E(t,r);function t(){return r.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return F(function(){var a=e.toBatchTensor(112,!0),o=[122.782,117.001,104.298],c=jt(a,o).div(I(255)),i=Gt(c,n.dense0,!0);return i=Gt(i,n.dense1),i=Gt(i,n.dense2),i=Gt(i,n.dense3),i=qt(i,[7,7],[2,2],"valid"),i})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Bn(e)},t.prototype.extractParams=function(e){return An(e)},t})(ut);function tt(r,t){return F(function(){return T(hr(r,t.weights),t.bias)})}function Ln(r,t,e){var n=[],a=ft(r),o=a.extractWeights,c=a.getRemainingWeights,i=Te(o,n),s=i(t,e,"fc");if(c().length!==0)throw new Error("weights remaing after extract: "+c().length);return{paramMappings:n,params:{fc:s}}}function Nn(r){var t=[],e=_t(r,t);function n(o){var c=e(o+"/weights",2),i=e(o+"/bias",1);return{weights:c,bias:i}}var a={fc:n("fc")};return ht(r,t),{params:a,paramMappings:t}}function Ar(r){var t={},e={};return Object.keys(r).forEach(function(n){var a=n.startsWith("fc")?e:t;a[n]=r[n]}),{featureExtractorMap:t,classifierMap:e}}var Br=(function(r){E(t,r);function t(e,n){var a=r.call(this,e)||this;return a._faceFeatureExtractor=n,a}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var n=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return F(function(){var o=e instanceof Jt?n.faceFeatureExtractor.forwardInput(e):e;return tt(o.as2D(o.shape[0],-1),a.fc)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var n=this.extractClassifierParams(e),a=n.params,o=n.paramMappings;this._params=a,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return Ln(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var n=Ar(e),a=n.featureExtractorMap,o=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),Nn(o)},t.prototype.extractParams=function(e){var n=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),o=a*n+a,c=e.slice(0,e.length-o),i=e.slice(e.length-o);return this.faceFeatureExtractor.extractWeights(c),this.extractClassifierParams(i)},t})(ut),ar=["neutral","happy","sad","angry","fearful","disgusted","surprised"],ke=(function(){function r(t){var e=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);ar.forEach(function(n,a){e[n]=t[a]})}return r.prototype.asSortedArray=function(){var t=this;return ar.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,n){return n.probability-e.probability})},r})(),In=(function(r){E(t,r);function t(e){return e===void 0&&(e=new kr),r.call(this,"FaceExpressionNet",e)||this}return t.prototype.forwardInput=function(e){var n=this;return F(function(){return At(n.runNet(e))})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.predictExpressions=function(e){return y(this,void 0,void 0,function(){var n,a,o,c,i=this;return w(this,function(s){switch(s.label){case 0:return[4,W(e)];case 1:return n=s.sent(),[4,this.forwardInput(n)];case 2:return a=s.sent(),[4,Promise.all(z(a).map(function(u){return y(i,void 0,void 0,function(){var h;return w(this,function(f){switch(f.label){case 0:return[4,u.data()];case 1:return h=f.sent(),u.dispose(),[2,h]}})})}))];case 3:return o=s.sent(),a.dispose(),c=o.map(function(u){return new ke(u)}),[2,n.isBatchInput?c:c[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t})(Br);function On(r){return r.expressions instanceof ke}function Lr(r,t){var e={expressions:t};return Object.assign({},r,e)}function Wn(r,t,e,n){e===void 0&&(e=.1);var a=Array.isArray(t)?t:[t];a.forEach(function(o){var c=o instanceof ke?o:On(o)?o.expressions:void 0;if(!c)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=c.asSortedArray(),s=i.filter(function(f){return f.probability>e}),u=Ot(o)?o.detection.box.bottomLeft:n||new C(0,0),h=new xe(s.map(function(f){return f.expression+" ("+Kt(f.probability)+")"}),u);h.draw(r)})}function Ae(r){return Ot(r)&&r.landmarks instanceof St&&r.unshiftedLandmarks instanceof St&&r.alignedRect instanceof Y}function ne(r,t){var e=r.detection.box,n=t.shiftBy(e.x,e.y),a=n.align(),o=r.detection.imageDims,c=new Y(r.detection.score,a.rescale(o.reverse()),o),i={landmarks:n,unshiftedLandmarks:t,alignedRect:c};return Object.assign({},r,i)}var Nr=(function(){function r(t){t===void 0&&(t={});var e=t.drawLines,n=e===void 0?!0:e,a=t.drawPoints,o=a===void 0?!0:a,c=t.lineWidth,i=t.lineColor,s=t.pointSize,u=t.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=c||1,this.pointSize=s||2,this.lineColor=i||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"}return r})(),Ir=(function(){function r(t,e){e===void 0&&(e={}),this.faceLandmarks=t,this.options=new Nr(e)}return r.prototype.draw=function(t){var e=rt(t),n=this.options,a=n.drawLines,o=n.drawPoints,c=n.lineWidth,i=n.lineColor,s=n.pointSize,u=n.pointColor;if(a&&this.faceLandmarks instanceof gr&&(e.strokeStyle=i,e.lineWidth=c,pt(e,this.faceLandmarks.getJawOutline()),pt(e,this.faceLandmarks.getLeftEyeBrow()),pt(e,this.faceLandmarks.getRightEyeBrow()),pt(e,this.faceLandmarks.getNose()),pt(e,this.faceLandmarks.getLeftEye(),!0),pt(e,this.faceLandmarks.getRightEye(),!0),pt(e,this.faceLandmarks.getMouth(),!0)),o){e.strokeStyle=u,e.fillStyle=u;var h=function(f){e.beginPath(),e.arc(f.x,f.y,s,0,2*Math.PI),e.fill()};this.faceLandmarks.positions.forEach(h)}},r})();function Rn(r,t){var e=Array.isArray(t)?t:[t];e.forEach(function(n){var a=n instanceof St?n:Ae(n)?n.landmarks:void 0;if(!a)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Ir(a).draw(r)})}const lo=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return ot},DrawBox:Fr,DrawBoxOptions:Pr,DrawFaceLandmarks:Ir,DrawFaceLandmarksOptions:Nr,DrawTextField:xe,DrawTextFieldOptions:we,drawContour:pt,drawDetections:En,drawFaceExpressions:Wn,drawFaceLandmarks:Rn},Symbol.toStringTag,{value:"Module"}));function jn(r,t){var e=re(r,t),n=Ce(r,t);function a(c,i,s){var u=n(c,i,s+"/separable_conv0"),h=n(i,i,s+"/separable_conv1"),f=e(c,i,1,s+"/expansion_conv");return{separable_conv0:u,separable_conv1:h,expansion_conv:f}}function o(c,i){var s=n(c,c,i+"/separable_conv0"),u=n(c,c,i+"/separable_conv1"),h=n(c,c,i+"/separable_conv2");return{separable_conv0:s,separable_conv1:u,separable_conv2:h}}return{extractConvParams:e,extractSeparableConvParams:n,extractReductionBlockParams:a,extractMainBlockParams:o}}function zn(r,t){var e=[],n=ft(r),a=n.extractWeights,o=n.getRemainingWeights,c=jn(a,e),i=c.extractConvParams,s=c.extractSeparableConvParams,u=c.extractReductionBlockParams,h=c.extractMainBlockParams,f=i(3,32,3,"entry_flow/conv_in"),v=u(32,64,"entry_flow/reduction_block_0"),l=u(64,128,"entry_flow/reduction_block_1"),p={conv_in:f,reduction_block_0:v,reduction_block_1:l},m={};Ct(t,0,1).forEach(function(x){m["main_block_"+x]=h(128,"middle_flow/main_block_"+x)});var g=u(128,256,"exit_flow/reduction_block"),b=s(256,512,"exit_flow/separable_conv"),P={reduction_block:g,separable_conv:b};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:m,exit_flow:P}}}function Hn(r,t){var e=_t(r,t),n=Cr(e),a=Se(e);function o(i){var s=a(i+"/separable_conv0"),u=a(i+"/separable_conv1"),h=n(i+"/expansion_conv");return{separable_conv0:s,separable_conv1:u,expansion_conv:h}}function c(i){var s=a(i+"/separable_conv0"),u=a(i+"/separable_conv1"),h=a(i+"/separable_conv2");return{separable_conv0:s,separable_conv1:u,separable_conv2:h}}return{extractConvParams:n,extractSeparableConvParams:a,extractReductionBlockParams:o,extractMainBlockParams:c}}function Gn(r,t){var e=[],n=Hn(r,e),a=n.extractConvParams,o=n.extractSeparableConvParams,c=n.extractReductionBlockParams,i=n.extractMainBlockParams,s=a("entry_flow/conv_in"),u=c("entry_flow/reduction_block_0"),h=c("entry_flow/reduction_block_1"),f={conv_in:s,reduction_block_0:u,reduction_block_1:h},v={};Ct(t,0,1).forEach(function(g){v["main_block_"+g]=i("middle_flow/main_block_"+g)});var l=c("exit_flow/reduction_block"),p=o("exit_flow/separable_conv"),m={reduction_block:l,separable_conv:p};return ht(r,e),{params:{entry_flow:f,middle_flow:v,exit_flow:m},paramMappings:e}}function Or(r,t,e){return T(Ft(r,t.filters,e,"same"),t.bias)}function fe(r,t,e){e===void 0&&(e=!0);var n=e?B(r):r;return n=$(n,t.separable_conv0,[1,1]),n=$(B(n),t.separable_conv1,[1,1]),n=R(n,[3,3],[2,2],"same"),n=T(n,Or(r,t.expansion_conv,[2,2])),n}function Vn(r,t){var e=$(B(r),t.separable_conv0,[1,1]);return e=$(B(e),t.separable_conv1,[1,1]),e=$(B(e),t.separable_conv2,[1,1]),e=T(e,r),e}var $n=(function(r){E(t,r);function t(e){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return t.prototype.forwardInput=function(e){var n=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return F(function(){var o=e.toBatchTensor(112,!0),c=[122.782,117.001,104.298],i=jt(o,c).div(I(256)),s=B(Or(i,a.entry_flow.conv_in,[2,2]));return s=fe(s,a.entry_flow.reduction_block_0,!1),s=fe(s,a.entry_flow.reduction_block_1),Ct(n._numMainBlocks,0,1).forEach(function(u){s=Vn(s,a.middle_flow["main_block_"+u])}),s=fe(s,a.exit_flow.reduction_block),s=B($(s,a.exit_flow.separable_conv,[1,1])),s})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Gn(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return zn(e,this._numMainBlocks)},t})(ut);function Yn(r){var t=[],e=ft(r),n=e.extractWeights,a=e.getRemainingWeights,o=Te(n,t),c=o(512,1,"fc/age"),i=o(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:c,gender:i}}}}function Un(r){var t=[],e=_t(r,t);function n(o){var c=e(o+"/weights",2),i=e(o+"/bias",1);return{weights:c,bias:i}}var a={fc:{age:n("fc/age"),gender:n("fc/gender")}};return ht(r,t),{params:a,paramMappings:t}}var kt;(function(r){r.FEMALE="female",r.MALE="male"})(kt||(kt={}));var Jn=(function(r){E(t,r);function t(e){e===void 0&&(e=new $n(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var n=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return F(function(){var o=e instanceof Jt?n.faceFeatureExtractor.forwardInput(e):e,c=qt(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),i=tt(c,a.fc.age).as1D(),s=tt(c,a.fc.gender);return{age:i,gender:s}})},t.prototype.forwardInput=function(e){var n=this;return F(function(){var a=n.runNet(e),o=a.age,c=a.gender;return{age:o,gender:At(c)}})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return y(this,void 0,void 0,function(){var n,a,o,c,i,s,u=this;return w(this,function(h){switch(h.label){case 0:return[4,W(e)];case 1:return n=h.sent(),[4,this.forwardInput(n)];case 2:return a=h.sent(),o=z(a.age),c=z(a.gender),i=o.map(function(f,v){return{ageTensor:f,genderTensor:c[v]}}),[4,Promise.all(i.map(function(f){var v=f.ageTensor,l=f.genderTensor;return y(u,void 0,void 0,function(){var p,m,g,b,P;return w(this,function(x){switch(x.label){case 0:return[4,v.data()];case 1:return p=x.sent()[0],[4,l.data()];case 2:return m=x.sent()[0],g=m>.5,b=g?kt.MALE:kt.FEMALE,P=g?m:1-m,v.dispose(),l.dispose(),[2,{age:p,gender:b,genderProbability:P}]}})})}))];case 3:return s=h.sent(),a.age.dispose(),a.gender.dispose(),[2,n.isBatchInput?s:s[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),r.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var n=this.extractClassifierParams(e),a=n.params,o=n.paramMappings;this._params=a,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return Yn(e)},t.prototype.extractParamsFromWeigthMap=function(e){var n=Ar(e),a=n.featureExtractorMap,o=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),Un(o)},t.prototype.extractParams=function(e){var n=1539,a=e.slice(0,e.length-n),o=e.slice(e.length-n);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(o)},t})(ut),Wr=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.postProcess=function(e,n,a){var o=a.map(function(i){var s=i.width,u=i.height,h=n/Math.max(u,s);return{width:s*h,height:u*h}}),c=o.length;return F(function(){var i=function(v,l){return Dt([yt([68],v),yt([68],l)],1).as2D(1,136).as1D()},s=function(v,l){var p=o[v],m=p.width,g=p.height;return l(m,g)?Math.abs(m-g)/2:0},u=function(v){return s(v,function(l,p){return l<p})},h=function(v){return s(v,function(l,p){return p<l})},f=e.mul(yt([c,136],n)).sub(Dt(Array.from(Array(c),function(v,l){return i(u(l),h(l))}))).div(Dt(Array.from(Array(c),function(v,l){return i(o[l].width,o[l].height)})));return f})},t.prototype.forwardInput=function(e){var n=this;return F(function(){var a=n.runNet(e);return n.postProcess(a,e.inputSize,e.inputDimensions.map(function(o){var c=o[0],i=o[1];return{height:c,width:i}}))})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.detectLandmarks=function(e){return y(this,void 0,void 0,function(){var n,a,o,c=this;return w(this,function(i){switch(i.label){case 0:return[4,W(e)];case 1:return n=i.sent(),a=F(function(){return z(c.forwardInput(n))}),[4,Promise.all(a.map(function(s,u){return y(c,void 0,void 0,function(){var h,f,v,l,p;return w(this,function(m){switch(m.label){case 0:return v=(f=Array).from,[4,s.data()];case 1:return h=v.apply(f,[m.sent()]),l=h.filter(function(g,b){return ve(b)}),p=h.filter(function(g,b){return!ve(b)}),[2,new gr(Array(68).fill(0).map(function(g,b){return new C(l[b],p[b])}),{height:n.getInputHeight(u),width:n.getInputWidth(u)})]}})})}))];case 2:return o=i.sent(),a.forEach(function(s){return s.dispose()}),[2,n.isBatchInput?o:o[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t})(Br),Rr=(function(r){E(t,r);function t(e){return e===void 0&&(e=new kr),r.call(this,"FaceLandmark68Net",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t})(Wr);function Xn(r){var t=[],e=Sr(r,t).extractDenseBlock3Params,n={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return ht(r,t),{params:n,paramMappings:t}}function qn(r){var t=[],e=ft(r),n=e.extractWeights,a=e.getRemainingWeights,o=Tr(n,t).extractDenseBlock3Params,c=o(3,32,"dense0",!0),i=o(32,64,"dense1"),s=o(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:c,dense1:i,dense2:s}}}var Zn=(function(r){E(t,r);function t(){return r.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return F(function(){var a=e.toBatchTensor(112,!0),o=[122.782,117.001,104.298],c=jt(a,o).div(I(255)),i=he(c,n.dense0,!0);return i=he(i,n.dense1),i=he(i,n.dense2),i=qt(i,[14,14],[2,2],"valid"),i})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Xn(e)},t.prototype.extractParams=function(e){return qn(e)},t})(ut),Kn=(function(r){E(t,r);function t(e){return e===void 0&&(e=new Zn),r.call(this,"FaceLandmark68TinyNet",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t})(Wr),po=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t})(Rr);function Qn(r,t){return T(Q(r,t.weights),t.biases)}function Be(r,t,e,n,a){a===void 0&&(a="same");var o=t.conv,c=o.filters,i=o.bias,s=Ft(r,c,e,a);return s=T(s,i),s=Qn(s,t.scale),n?B(s):s}function ta(r,t){return Be(r,t,[1,1],!0)}function jr(r,t){return Be(r,t,[1,1],!1)}function zr(r,t){return Be(r,t,[2,2],!0,"valid")}function ea(r,t){function e(i,s,u){var h=r(i),f=h.length/(s*u*u);if(pr(f))throw new Error("depth has to be an integer: "+f+", weights.length: "+h.length+", numFilters: "+s+", filterSize: "+u);return F(function(){return Pt(xt(h,[s,f,u,u]),[2,3,1,0])})}function n(i,s,u,h){var f=e(i,s,u),v=V(r(s));return t.push({paramPath:h+"/filters"},{paramPath:h+"/bias"}),{filters:f,bias:v}}function a(i,s){var u=V(r(i)),h=V(r(i));return t.push({paramPath:s+"/weights"},{paramPath:s+"/biases"}),{weights:u,biases:h}}function o(i,s,u,h){var f=n(i,s,u,h+"/conv"),v=a(s,h+"/scale");return{conv:f,scale:v}}function c(i,s,u,h,f){f===void 0&&(f=!1);var v=o((f?.5:1)*i,s,u,h+"/conv1"),l=o(i,s,u,h+"/conv2");return{conv1:v,conv2:l}}return{extractConvLayerParams:o,extractResidualLayerParams:c}}function ra(r){var t=ft(r),e=t.extractWeights,n=t.getRemainingWeights,a=[],o=ea(e,a),c=o.extractConvLayerParams,i=o.extractResidualLayerParams,s=c(4704,32,7,"conv32_down"),u=i(9216,32,3,"conv32_1"),h=i(9216,32,3,"conv32_2"),f=i(9216,32,3,"conv32_3"),v=i(36864,64,3,"conv64_down",!0),l=i(36864,64,3,"conv64_1"),p=i(36864,64,3,"conv64_2"),m=i(36864,64,3,"conv64_3"),g=i(147456,128,3,"conv128_down",!0),b=i(147456,128,3,"conv128_1"),P=i(147456,128,3,"conv128_2"),x=i(589824,256,3,"conv256_down",!0),d=i(589824,256,3,"conv256_1"),_=i(589824,256,3,"conv256_2"),M=i(589824,256,3,"conv256_down_out"),k=F(function(){return Pt(ur(e(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var L={conv32_down:s,conv32_1:u,conv32_2:h,conv32_3:f,conv64_down:v,conv64_1:l,conv64_2:p,conv64_3:m,conv128_down:g,conv128_1:b,conv128_2:P,conv256_down:x,conv256_1:d,conv256_2:_,conv256_down_out:M,fc:k};return{params:L,paramMappings:a}}function na(r,t){var e=_t(r,t);function n(c){var i=e(c+"/scale/weights",1),s=e(c+"/scale/biases",1);return{weights:i,biases:s}}function a(c){var i=e(c+"/conv/filters",4),s=e(c+"/conv/bias",1),u=n(c);return{conv:{filters:i,bias:s},scale:u}}function o(c){return{conv1:a(c+"/conv1"),conv2:a(c+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:o}}function aa(r){var t=[],e=na(r,t),n=e.extractConvLayerParams,a=e.extractResidualLayerParams,o=n("conv32_down"),c=a("conv32_1"),i=a("conv32_2"),s=a("conv32_3"),u=a("conv64_down"),h=a("conv64_1"),f=a("conv64_2"),v=a("conv64_3"),l=a("conv128_down"),p=a("conv128_1"),m=a("conv128_2"),g=a("conv256_down"),b=a("conv256_1"),P=a("conv256_2"),x=a("conv256_down_out"),d=r.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!lr(d))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+d);var _={conv32_down:o,conv32_1:c,conv32_2:i,conv32_3:s,conv64_down:u,conv64_1:h,conv64_2:f,conv64_3:v,conv128_down:l,conv128_1:p,conv128_2:m,conv256_down:g,conv256_1:b,conv256_2:P,conv256_down_out:x,fc:d};return ht(r,t),{params:_,paramMappings:t}}function Z(r,t){var e=ta(r,t.conv1);return e=jr(e,t.conv2),e=T(e,r),e=B(e),e}function Vt(r,t){var e=zr(r,t.conv1);e=jr(e,t.conv2);var n=qt(r,2,2,"valid"),a=se(n.shape),o=n.shape[3]!==e.shape[3],c=n.shape[1]!==e.shape[1]||n.shape[2]!==e.shape[2];if(c){var i=Nt(e.shape);i[1]=1;var s=se(i);e=it([e,s],1);var u=Nt(e.shape);u[2]=1;var h=se(u);e=it([e,h],2)}return n=o?it([n,a],3):n,e=T(n,e),e=B(e),e}var Hr=(function(r){E(t,r);function t(){return r.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return F(function(){var a=e.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],c=jt(a,o).div(I(256)),i=zr(c,n.conv32_down);i=R(i,3,2,"valid"),i=Z(i,n.conv32_1),i=Z(i,n.conv32_2),i=Z(i,n.conv32_3),i=Vt(i,n.conv64_down),i=Z(i,n.conv64_1),i=Z(i,n.conv64_2),i=Z(i,n.conv64_3),i=Vt(i,n.conv128_down),i=Z(i,n.conv128_1),i=Z(i,n.conv128_2),i=Vt(i,n.conv256_down),i=Z(i,n.conv256_1),i=Z(i,n.conv256_2),i=Vt(i,n.conv256_down_out);var s=i.mean([1,2]),u=hr(s,n.fc);return u})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return y(this,void 0,void 0,function(){var n,a,o,c=this;return w(this,function(i){switch(i.label){case 0:return[4,W(e)];case 1:return n=i.sent(),a=F(function(){return z(c.forwardInput(n))}),[4,Promise.all(a.map(function(s){return s.data()}))];case 2:return o=i.sent(),a.forEach(function(s){return s.dispose()}),[2,n.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return aa(e)},t.prototype.extractParams=function(e){return ra(e)},t})(ut);function mo(r){var t=new Hr;return t.extractWeights(r),t}function Gr(r,t){var e={descriptor:t};return Object.assign({},r,e)}function go(r){return typeof r.age=="number"}function Vr(r,t){var e={age:t};return Object.assign({},r,e)}function _o(r){return(r.gender===kt.MALE||r.gender===kt.FEMALE)&&Ut(r.genderProbability)}function $r(r,t,e){var n={gender:t,genderProbability:e};return Object.assign({},r,n)}var Le=(function(){function r(t){var e=t===void 0?{}:t,n=e.minFaceSize,a=e.scaleFactor,o=e.maxNumScales,c=e.scoreThresholds,i=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=a||.709,this._maxNumScales=o||10,this._scoreThresholds=c||[.6,.7,.7],this._scaleSteps=i,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(s){return typeof s!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(s){return typeof s!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r})();function oa(r,t){function e(s,u){var h=xt(r(9*s),[3,3,s,1]),f=V(r(s)),v=V(r(s)),l=V(r(s)),p=V(r(s));return t.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:h,batch_norm_scale:f,batch_norm_offset:v,batch_norm_mean:l,batch_norm_variance:p}}function n(s,u,h,f,v){var l=xt(r(s*u*h*h),[h,h,s,u]),p=V(r(u));return t.push({paramPath:f+"/filters"},{paramPath:f+"/"+(v?"batch_norm_offset":"bias")}),{filters:l,bias:p}}function a(s,u,h,f){var v=n(s,u,h,f,!0),l=v.filters,p=v.bias;return{filters:l,batch_norm_offset:p}}function o(s,u,h){var f=e(s,h+"/depthwise_conv"),v=a(s,u,1,h+"/pointwise_conv");return{depthwise_conv:f,pointwise_conv:v}}function c(){var s=a(3,32,3,"mobilenetv1/conv_0"),u=o(32,64,"mobilenetv1/conv_1"),h=o(64,128,"mobilenetv1/conv_2"),f=o(128,128,"mobilenetv1/conv_3"),v=o(128,256,"mobilenetv1/conv_4"),l=o(256,256,"mobilenetv1/conv_5"),p=o(256,512,"mobilenetv1/conv_6"),m=o(512,512,"mobilenetv1/conv_7"),g=o(512,512,"mobilenetv1/conv_8"),b=o(512,512,"mobilenetv1/conv_9"),P=o(512,512,"mobilenetv1/conv_10"),x=o(512,512,"mobilenetv1/conv_11"),d=o(512,1024,"mobilenetv1/conv_12"),_=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:s,conv_1:u,conv_2:h,conv_3:f,conv_4:v,conv_5:l,conv_6:p,conv_7:m,conv_8:g,conv_9:b,conv_10:P,conv_11:x,conv_12:d,conv_13:_}}function i(){var s=a(1024,256,1,"prediction_layer/conv_0"),u=a(256,512,3,"prediction_layer/conv_1"),h=a(512,128,1,"prediction_layer/conv_2"),f=a(128,256,3,"prediction_layer/conv_3"),v=a(256,128,1,"prediction_layer/conv_4"),l=a(128,256,3,"prediction_layer/conv_5"),p=a(256,64,1,"prediction_layer/conv_6"),m=a(64,128,3,"prediction_layer/conv_7"),g=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),b=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),P=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),d=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),_=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),M=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),k=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),L=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),A=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),D=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),O=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),H={box_encoding_predictor:g,class_predictor:b},X={box_encoding_predictor:P,class_predictor:x},U={box_encoding_predictor:d,class_predictor:_},bt={box_encoding_predictor:M,class_predictor:k},Et={box_encoding_predictor:L,class_predictor:A},nt={box_encoding_predictor:D,class_predictor:O};return{conv_0:s,conv_1:u,conv_2:h,conv_3:f,conv_4:v,conv_5:l,conv_6:p,conv_7:m,box_predictor_0:H,box_predictor_1:X,box_predictor_2:U,box_predictor_3:bt,box_predictor_4:Et,box_predictor_5:nt}}return{extractMobilenetV1Params:c,extractPredictionLayerParams:i}}function ia(r){var t=[],e=ft(r),n=e.extractWeights,a=e.getRemainingWeights,o=oa(n,t),c=o.extractMobilenetV1Params,i=o.extractPredictionLayerParams,s=c(),u=i(),h=hn(n(5118*4),[1,5118,4]),f={extra_dim:h};if(t.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:s,prediction_layer:u,output_layer:f},paramMappings:t}}function ca(r,t){var e=_t(r,t);function n(u,h,f){var v=e(u+"/Conv2d_"+h+"_pointwise/weights",4,f+"/filters"),l=e(u+"/Conv2d_"+h+"_pointwise/convolution_bn_offset",1,f+"/batch_norm_offset");return{filters:v,batch_norm_offset:l}}function a(u){var h="mobilenetv1/conv_"+u,f="MobilenetV1/Conv2d_"+u+"_depthwise",v=h+"/depthwise_conv",l=h+"/pointwise_conv",p=e(f+"/depthwise_weights",4,v+"/filters"),m=e(f+"/BatchNorm/gamma",1,v+"/batch_norm_scale"),g=e(f+"/BatchNorm/beta",1,v+"/batch_norm_offset"),b=e(f+"/BatchNorm/moving_mean",1,v+"/batch_norm_mean"),P=e(f+"/BatchNorm/moving_variance",1,v+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:m,batch_norm_offset:g,batch_norm_mean:b,batch_norm_variance:P},pointwise_conv:n("MobilenetV1",u,l)}}function o(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function c(u,h){var f=e(u+"/weights",4,h+"/filters"),v=e(u+"/biases",1,h+"/bias");return{filters:f,bias:v}}function i(u){var h=c("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),f=c("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:h,class_predictor:f}}function s(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:i(0),box_predictor_1:i(1),box_predictor_2:i(2),box_predictor_3:i(3),box_predictor_4:i(4),box_predictor_5:i(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:s}}function sa(r){var t=[],e=ca(r,t),n=e.extractMobilenetV1Params,a=e.extractPredictionLayerParams,o=r["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Rt(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var c={mobilenetv1:n(),prediction_layer:a(),output_layer:{extra_dim:o}};return ht(r,t),{params:c,paramMappings:t}}function K(r,t,e){return F(function(){var n=Ft(r,t.filters,e,"same");return n=T(n,t.batch_norm_offset),fr(n,0,6)})}var ua=.0010000000474974513;function ha(r,t,e){return F(function(){var n=fn(r,t.filters,e,"same");return n=vn(n,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,ua),fr(n,0,6)})}function fa(r){return[2,4,6,12].some(function(t){return t===r})?[2,2]:[1,1]}function va(r,t){return F(function(){var e=null,n=K(r,t.conv_0,[2,2]),a=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(a.forEach(function(o,c){var i=c+1,s=fa(i);n=ha(n,o.depthwise_conv,s),n=K(n,o.pointwise_conv,[1,1]),i===11&&(e=n)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:e}})}function la(r,t,e,n,a){var o=r.shape[0],c=Math.min(e,o),i=t.map(function(h,f){return{score:h,boxIndex:f}}).filter(function(h){return h.score>a}).sort(function(h,f){return f.score-h.score}),s=function(h){return h<=n?1:0},u=[];return i.forEach(function(h){if(!(u.length>=c)){for(var f=h.score,v=u.length-1;v>=0;--v){var l=pa(r,h.boxIndex,u[v]);if(l!==0&&(h.score*=s(l),h.score<=a))break}f===h.score&&u.push(h.boxIndex)}}),u}function pa(r,t,e){var n=r.arraySync(),a=Math.min(n[t][0],n[t][2]),o=Math.min(n[t][1],n[t][3]),c=Math.max(n[t][0],n[t][2]),i=Math.max(n[t][1],n[t][3]),s=Math.min(n[e][0],n[e][2]),u=Math.min(n[e][1],n[e][3]),h=Math.max(n[e][0],n[e][2]),f=Math.max(n[e][1],n[e][3]),v=(c-a)*(i-o),l=(h-s)*(f-u);if(v<=0||l<=0)return 0;var p=Math.max(a,s),m=Math.max(o,u),g=Math.min(c,h),b=Math.min(i,f),P=Math.max(g-p,0)*Math.max(b-m,0);return P/(v+l-P)}function da(r){var t=z(Pt(r,[1,0])),e=[J(t[2],t[0]),J(t[3],t[1])],n=[T(t[0],dt(e[0],I(2))),T(t[1],dt(e[1],I(2)))];return{sizes:e,centers:n}}function ma(r,t){var e=da(r),n=e.sizes,a=e.centers,o=z(Pt(t,[1,0])),c=dt(Q(Qe(dt(o[2],I(5))),n[0]),I(2)),i=T(Q(dt(o[0],I(10)),n[0]),a[0]),s=dt(Q(Qe(dt(o[3],I(5))),n[1]),I(2)),u=T(Q(dt(o[1],I(10)),n[1]),a[1]);return Pt(Dt([J(i,c),J(u,s),T(i,c),T(u,s)]),[1,0])}function ga(r,t,e){return F(function(){var n=r.shape[0],a=ma(mt(ln(e.extra_dim,[n,1,1]),[-1,4]),mt(r,[-1,4]));a=mt(a,[n,a.shape[0]/n,4]);var o=pn(Ke(t,[0,0,1],[-1,-1,-1])),c=Ke(o,[0,0,0],[-1,-1,1]);c=mt(c,[n,c.shape[1]]);var i=z(a),s=z(c);return{boxes:i,scores:s}})}function Mt(r,t){return F(function(){var e=r.shape[0],n=mt(q(r,t.box_encoding_predictor),[e,-1,1,4]),a=mt(q(r,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:n,classPrediction:a}})}function _a(r,t,e){return F(function(){var n=K(r,e.conv_0,[1,1]),a=K(n,e.conv_1,[2,2]),o=K(a,e.conv_2,[1,1]),c=K(o,e.conv_3,[2,2]),i=K(c,e.conv_4,[1,1]),s=K(i,e.conv_5,[2,2]),u=K(s,e.conv_6,[1,1]),h=K(u,e.conv_7,[2,2]),f=Mt(t,e.box_predictor_0),v=Mt(r,e.box_predictor_1),l=Mt(a,e.box_predictor_2),p=Mt(c,e.box_predictor_3),m=Mt(s,e.box_predictor_4),g=Mt(h,e.box_predictor_5),b=it([f.boxPredictionEncoding,v.boxPredictionEncoding,l.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),P=it([f.classPrediction,v.classPrediction,l.classPrediction,p.classPrediction,m.classPrediction,g.classPrediction],1);return{boxPredictions:b,classPredictions:P}})}var Lt=(function(){function r(t){var e=t===void 0?{}:t,n=e.minConfidence,a=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r})(),Ne=(function(r){E(t,r);function t(){return r.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(e){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return F(function(){var a=e.toBatchTensor(512,!1).toFloat(),o=J(Q(a,I(.007843137718737125)),I(1)),c=va(o,n.mobilenetv1),i=_a(c.out,c.conv11,n.prediction_layer),s=i.boxPredictions,u=i.classPredictions;return ga(s,u,n.output_layer)})},t.prototype.forward=function(e){return y(this,void 0,void 0,function(){var n;return w(this,function(a){switch(a.label){case 0:return n=this.forwardInput,[4,W(e)];case 1:return[2,n.apply(this,[a.sent()])]}})})},t.prototype.locateFaces=function(e,n){return n===void 0&&(n={}),y(this,void 0,void 0,function(){var a,o,c,i,s,u,h,f,v,l,p,m,g,b,P,x,d,_,M,k,L;return w(this,function(A){switch(A.label){case 0:return a=new Lt(n),o=a.maxResults,c=a.minConfidence,[4,W(e)];case 1:for(i=A.sent(),s=this.forwardInput(i),u=s.boxes,h=s.scores,f=u[0],v=h[0],l=1;l<u.length;l++)u[l].dispose(),h[l].dispose();return g=(m=Array).from,[4,v.data()];case 2:return p=g.apply(m,[A.sent()]),b=.5,P=la(f,p,o,b,c),x=i.getReshapedInputDimensions(0),d=i.inputSize,_=d/x.width,M=d/x.height,k=f.arraySync(),L=P.map(function(D){var O=[Math.max(0,k[D][0]),Math.min(1,k[D][2])].map(function(nt){return nt*M}),H=O[0],X=O[1],U=[Math.max(0,k[D][1]),Math.min(1,k[D][3])].map(function(nt){return nt*_}),bt=U[0],Et=U[1];return new Y(p[D],new _e(bt,H,Et-bt,X-H),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),f.dispose(),v.dispose(),[2,L]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return sa(e)},t.prototype.extractParams=function(e){return ia(e)},t})(ut);function ba(r){var t=new Ne;return t.extractWeights(r),t}function bo(r){return ba(r)}var yo=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t})(Ne),ya=.4,wa=[new C(.738768,.874946),new C(2.42204,2.65704),new C(4.30971,7.04493),new C(10.246,4.59428),new C(12.6868,11.8741)],xa=[new C(1.603231,2.094468),new C(6.041143,7.080126),new C(2.882459,3.518061),new C(4.266906,5.178857),new C(9.041765,10.66308)],Pa=[117.001,114.697,97.404],Fa="tiny_yolov2_model",Ea="tiny_yolov2_separable_conv_model",$t=function(r){return typeof r=="number"};function Ma(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!$t(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(t){return t||{}}).every(function(t){return $t(t.x)&&$t(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every($t)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function Ie(r){return F(function(){var t=Q(r,I(.10000000149011612));return T(B(J(r,t)),t)})}function vt(r,t){return F(function(){var e=vr(r,[[0,0],[1,1],[1,1],[0,0]]);return e=Ft(e,t.conv.filters,[1,1],"valid"),e=J(e,t.bn.sub),e=Q(e,t.bn.truediv),e=T(e,t.conv.bias),Ie(e)})}function lt(r,t){return F(function(){var e=vr(r,[[0,0],[1,1],[1,1],[0,0]]);return e=sr(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=T(e,t.bias),Ie(e)})}function Da(r,t){var e=re(r,t);function n(c,i){var s=V(r(c)),u=V(r(c));return t.push({paramPath:i+"/sub"},{paramPath:i+"/truediv"}),{sub:s,truediv:u}}function a(c,i,s){var u=e(c,i,3,s+"/conv"),h=n(i,s+"/bn");return{conv:u,bn:h}}var o=Ce(r,t);return{extractConvParams:e,extractConvWithBatchNormParams:a,extractSeparableConvParams:o}}function Ta(r,t,e,n){var a=ft(r),o=a.extractWeights,c=a.getRemainingWeights,i=[],s=Da(o,i),u=s.extractConvParams,h=s.extractConvWithBatchNormParams,f=s.extractSeparableConvParams,v;if(t.withSeparableConvs){var l=n[0],p=n[1],m=n[2],g=n[3],b=n[4],P=n[5],x=n[6],d=n[7],_=n[8],M=t.isFirstLayerConv2d?u(l,p,3,"conv0"):f(l,p,"conv0"),k=f(p,m,"conv1"),L=f(m,g,"conv2"),A=f(g,b,"conv3"),D=f(b,P,"conv4"),O=f(P,x,"conv5"),H=d?f(x,d,"conv6"):void 0,X=_?f(d,_,"conv7"):void 0,U=u(_||d||x,5*e,1,"conv8");v={conv0:M,conv1:k,conv2:L,conv3:A,conv4:D,conv5:O,conv6:H,conv7:X,conv8:U}}else{var l=n[0],p=n[1],m=n[2],g=n[3],b=n[4],P=n[5],x=n[6],d=n[7],_=n[8],M=h(l,p,"conv0"),k=h(p,m,"conv1"),L=h(m,g,"conv2"),A=h(g,b,"conv3"),D=h(b,P,"conv4"),O=h(P,x,"conv5"),H=h(x,d,"conv6"),X=h(d,_,"conv7"),U=u(_,5*e,1,"conv8");v={conv0:M,conv1:k,conv2:L,conv3:A,conv4:D,conv5:O,conv6:H,conv7:X,conv8:U}}if(c().length!==0)throw new Error("weights remaing after extract: "+c().length);return{params:v,paramMappings:i}}function Ca(r,t){var e=_t(r,t);function n(i){var s=e(i+"/sub",1),u=e(i+"/truediv",1);return{sub:s,truediv:u}}function a(i){var s=e(i+"/filters",4),u=e(i+"/bias",1);return{filters:s,bias:u}}function o(i){var s=a(i+"/conv"),u=n(i+"/bn");return{conv:s,bn:u}}var c=Se(e);return{extractConvParams:a,extractConvWithBatchNormParams:o,extractSeparableConvParams:c}}function Sa(r,t){var e=[],n=Ca(r,e),a=n.extractConvParams,o=n.extractConvWithBatchNormParams,c=n.extractSeparableConvParams,i;if(t.withSeparableConvs){var s=t.filterSizes&&t.filterSizes.length||9;i={conv0:t.isFirstLayerConv2d?a("conv0"):c("conv0"),conv1:c("conv1"),conv2:c("conv2"),conv3:c("conv3"),conv4:c("conv4"),conv5:c("conv5"),conv6:s>7?c("conv6"):void 0,conv7:s>8?c("conv7"):void 0,conv8:a("conv8")}}else i={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:a("conv8")};return ht(r,e),{params:i,paramMappings:e}}var or;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(or||(or={}));var ae=(function(){function r(t){var e=t===void 0?{}:t,n=e.inputSize,a=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r})(),Yr=(function(r){E(t,r);function t(e){var n=r.call(this,"TinyYolov2")||this;return Ma(e),n._config=e,n}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,n){var a=vt(e,n.conv0);return a=R(a,[2,2],[2,2],"same"),a=vt(a,n.conv1),a=R(a,[2,2],[2,2],"same"),a=vt(a,n.conv2),a=R(a,[2,2],[2,2],"same"),a=vt(a,n.conv3),a=R(a,[2,2],[2,2],"same"),a=vt(a,n.conv4),a=R(a,[2,2],[2,2],"same"),a=vt(a,n.conv5),a=R(a,[2,2],[1,1],"same"),a=vt(a,n.conv6),a=vt(a,n.conv7),q(a,n.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,n){var a=this.config.isFirstLayerConv2d?Ie(q(e,n.conv0,"valid",!1)):lt(e,n.conv0);return a=R(a,[2,2],[2,2],"same"),a=lt(a,n.conv1),a=R(a,[2,2],[2,2],"same"),a=lt(a,n.conv2),a=R(a,[2,2],[2,2],"same"),a=lt(a,n.conv3),a=R(a,[2,2],[2,2],"same"),a=lt(a,n.conv4),a=R(a,[2,2],[2,2],"same"),a=lt(a,n.conv5),a=R(a,[2,2],[1,1],"same"),a=n.conv6?lt(a,n.conv6):a,a=n.conv7?lt(a,n.conv7):a,q(a,n.conv8,"valid",!1)},t.prototype.forwardInput=function(e,n){var a=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return F(function(){var c=e.toBatchTensor(n,!1).toFloat();return c=a.config.meanRgb?jt(c,a.config.meanRgb):c,c=c.div(I(256)),a.config.withSeparableConvs?a.runMobilenet(c,o):a.runTinyYolov2(c,o)})},t.prototype.forward=function(e,n){return y(this,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,W(e)];case 1:return[4,a.apply(this,[o.sent(),n])];case 2:return[2,o.sent()]}})})},t.prototype.detect=function(e,n){return n===void 0&&(n={}),y(this,void 0,void 0,function(){var a,o,c,i,s,u,h,f,v,l,p,m,g,b,P=this;return w(this,function(x){switch(x.label){case 0:return a=new ae(n),o=a.inputSize,c=a.scoreThreshold,[4,W(e)];case 1:return i=x.sent(),[4,this.forwardInput(i,o)];case 2:return s=x.sent(),u=F(function(){return z(s)[0].expandDims()}),h={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(u,i.getReshapedInputDimensions(0),c)];case 3:return f=x.sent(),s.dispose(),u.dispose(),v=f.map(function(d){return d.box}),l=f.map(function(d){return d.score}),p=f.map(function(d){return d.classScore}),m=f.map(function(d){return P.config.classes[d.label]}),g=It(v.map(function(d){return d.rescale(o)}),l,this.config.iouThreshold,!0),b=g.map(function(d){return new mr(l[d],p[d],m[d],v[d],h)}),[2,b]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return Sa(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,a=n?n.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return Ta(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,n,a){return y(this,void 0,void 0,function(){var o,c,i,s,u,h,f,v,l,p,m,g,b,P,x,d,_,M,k,L,A,D,O,H,X,U,bt,Et,nt,ie=this;return w(this,function(at){switch(at.label){case 0:return o=n.width,c=n.height,i=Math.max(o,c),s=i/o,u=i/c,h=e.shape[1],f=this.config.anchors.length,v=F(function(){var ce=e.reshape([h,h,f,ie.boxEncodingSize]),an=ce.slice([0,0,0,0],[h,h,f,4]),on=ce.slice([0,0,0,4],[h,h,f,1]),cn=ie.withClassScores?At(ce.slice([0,0,0,5],[h,h,f,ie.config.classes.length]),3):I(0);return[an,on,cn]}),l=v[0],p=v[1],m=v[2],g=[],[4,p.array()];case 1:return b=at.sent(),[4,l.array()];case 2:P=at.sent(),x=0,at.label=3;case 3:if(!(x<h))return[3,12];d=0,at.label=4;case 4:if(!(d<h))return[3,11];_=0,at.label=5;case 5:return _<f?(M=ue(b[x][d][_][0]),!a||M>a?(k=(d+ue(P[x][d][_][0]))/h*s,L=(x+ue(P[x][d][_][1]))/h*u,A=Math.exp(P[x][d][_][2])*this.config.anchors[_].x/h*s,D=Math.exp(P[x][d][_][3])*this.config.anchors[_].y/h*u,O=k-A/2,H=L-D/2,X={row:x,col:d,anchor:_},this.withClassScores?[4,this.extractPredictedClass(m,X)]:[3,7]):[3,9]):[3,10];case 6:return nt=at.sent(),[3,8];case 7:nt={classScore:1,label:0},at.label=8;case 8:U=nt,bt=U.classScore,Et=U.label,g.push(G({box:new te(O,H,O+A,H+D),score:M,classScore:M*bt,label:Et},X)),at.label=9;case 9:return _++,[3,5];case 10:return d++,[3,4];case 11:return x++,[3,3];case 12:return l.dispose(),p.dispose(),m.dispose(),[2,g]}})})},t.prototype.extractPredictedClass=function(e,n){return y(this,void 0,void 0,function(){var a,o,c,i;return w(this,function(s){switch(s.label){case 0:return a=n.row,o=n.col,c=n.anchor,[4,e.array()];case 1:return i=s.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,h){return i[a][o][c][h]}).map(function(u,h){return{classScore:u,label:h}}).reduce(function(u,h){return u.classScore>h.classScore?u:h})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t})(ut),Ur=(function(r){E(t,r);function t(e){e===void 0&&(e=!0);var n=this,a=Object.assign({},{withSeparableConvs:e,iouThreshold:ya,classes:["face"]},e?{anchors:xa,meanRgb:Pa}:{anchors:wa,withClassScores:!0});return n=r.call(this,a)||this,n}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,n){return y(this,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return[4,this.detect(e,n)];case 1:return a=o.sent(),[2,a.map(function(c){return new Y(c.score,c.relativeBox,{width:c.imageWidth,height:c.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?Ea:Fa},t.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},t})(Yr);function wo(r,t){t===void 0&&(t=!0);var e=new Ur(t);return e.extractWeights(r),e}var ka=(function(r){E(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return t})(ae),zt=(function(){function r(){}return r.prototype.then=function(t){return y(this,void 0,void 0,function(){var e;return w(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return y(this,void 0,void 0,function(){return w(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},r})();function oe(r,t,e,n,a){return a===void 0&&(a=function(o){var c=o.alignedRect;return c}),y(this,void 0,void 0,function(){var o,c,i,s,u;return w(this,function(h){switch(h.label){case 0:return o=r.map(function(f){return Ae(f)?a(f):f.detection}),i=n,i?[3,5]:t instanceof st?[4,Me(t,o)]:[3,2];case 1:return s=h.sent(),[3,4];case 2:return[4,Ee(t,o)];case 3:s=h.sent(),h.label=4;case 4:i=s,h.label=5;case 5:return c=i,[4,e(c)];case 6:return u=h.sent(),c.forEach(function(f){return f instanceof st&&f.dispose()}),[2,u]}})})}function Oe(r,t,e,n,a){return y(this,void 0,void 0,function(){var o=this;return w(this,function(c){return[2,oe([r],t,function(i){return y(o,void 0,void 0,function(){return w(this,function(s){return[2,e(i[0])]})})},n,a)]})})}function Aa(r){return F(function(){return Dt(z(r,3).reverse(),3)})}var Yt=2,Xt=12;function Ba(r,t){var e=re(r,t),n=Te(r,t);function a(u,h){var f=V(r(u));return t.push({paramPath:h}),f}function o(u,h,f){f===void 0&&(f=!1);var v=e(u[0],u[1],3,h+"/conv1"),l=a(u[1],h+"/prelu1_alpha"),p=e(u[1],u[2],3,h+"/conv2"),m=a(u[2],h+"/prelu2_alpha"),g=e(u[2],u[3],f?2:3,h+"/conv3"),b=a(u[3],h+"/prelu3_alpha");return{conv1:v,prelu1_alpha:l,conv2:p,prelu2_alpha:m,conv3:g,prelu3_alpha:b}}function c(){var u=o([3,10,16,32],"pnet"),h=e(32,2,1,"pnet/conv4_1"),f=e(32,4,1,"pnet/conv4_2");return G(G({},u),{conv4_1:h,conv4_2:f})}function i(){var u=o([3,28,48,64],"rnet",!0),h=n(576,128,"rnet/fc1"),f=a(128,"rnet/prelu4_alpha"),v=n(128,2,"rnet/fc2_1"),l=n(128,4,"rnet/fc2_2");return G(G({},u),{fc1:h,prelu4_alpha:f,fc2_1:v,fc2_2:l})}function s(){var u=o([3,32,64,64],"onet"),h=e(64,128,2,"onet/conv4"),f=a(128,"onet/prelu4_alpha"),v=n(1152,256,"onet/fc1"),l=a(256,"onet/prelu5_alpha"),p=n(256,2,"onet/fc2_1"),m=n(256,4,"onet/fc2_2"),g=n(256,10,"onet/fc2_3");return G(G({},u),{conv4:h,prelu4_alpha:f,fc1:v,prelu5_alpha:l,fc2_1:p,fc2_2:m,fc2_3:g})}return{extractPNetParams:c,extractRNetParams:i,extractONetParams:s}}function La(r){var t=ft(r),e=t.extractWeights,n=t.getRemainingWeights,a=[],o=Ba(e,a),c=o.extractPNetParams,i=o.extractRNetParams,s=o.extractONetParams,u=c(),h=i(),f=s();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:u,rnet:h,onet:f},paramMappings:a}}function Na(r,t){var e=_t(r,t);function n(h){var f=e(h+"/weights",4,h+"/filters"),v=e(h+"/bias",1);return{filters:f,bias:v}}function a(h){var f=e(h+"/weights",2),v=e(h+"/bias",1);return{weights:f,bias:v}}function o(h){return e(h,1)}function c(h){var f=n(h+"/conv1"),v=o(h+"/prelu1_alpha"),l=n(h+"/conv2"),p=o(h+"/prelu2_alpha"),m=n(h+"/conv3"),g=o(h+"/prelu3_alpha");return{conv1:f,prelu1_alpha:v,conv2:l,prelu2_alpha:p,conv3:m,prelu3_alpha:g}}function i(){var h=c("pnet"),f=n("pnet/conv4_1"),v=n("pnet/conv4_2");return G(G({},h),{conv4_1:f,conv4_2:v})}function s(){var h=c("rnet"),f=a("rnet/fc1"),v=o("rnet/prelu4_alpha"),l=a("rnet/fc2_1"),p=a("rnet/fc2_2");return G(G({},h),{fc1:f,prelu4_alpha:v,fc2_1:l,fc2_2:p})}function u(){var h=c("onet"),f=n("onet/conv4"),v=o("onet/prelu4_alpha"),l=a("onet/fc1"),p=o("onet/prelu5_alpha"),m=a("onet/fc2_1"),g=a("onet/fc2_2"),b=a("onet/fc2_3");return G(G({},h),{conv4:f,prelu4_alpha:v,fc1:l,prelu5_alpha:p,fc2_1:m,fc2_2:g,fc2_3:b})}return{extractPNetParams:i,extractRNetParams:s,extractONetParams:u}}function Ia(r){var t=[],e=Na(r,t),n=e.extractPNetParams,a=e.extractRNetParams,o=e.extractONetParams,c=n(),i=a(),s=o();return ht(r,t),{params:{pnet:c,rnet:i,onet:s},paramMappings:t}}function de(r,t){var e=t[0],n=t[1];return{height:Math.floor(e*r),width:Math.floor(n*r)}}function Oa(r,t,e){for(var n=e[0],a=e[1],o=Xt/r,c=[],i=Math.min(n,a)*o,s=0;i>=12;)c.push(o*Math.pow(t,s)),i=i*t,s+=1;return c}var We=(function(r){E(t,r);function t(e,n,a,o){return r.call(this,{left:e,top:n,right:a,bottom:o},!0)||this}return t})(et);function Jr(r){return F(function(){return Q(J(r,I(127.5)),I(.0078125))})}function Tt(r,t){return F(function(){return T(B(r),Q(t,tr(B(tr(r)))))})}function Re(r,t,e){return e===void 0&&(e=!1),F(function(){var n=q(r,t.conv1,"valid");return n=Tt(n,t.prelu1_alpha),n=R(n,e?[2,2]:[3,3],[2,2],"same"),n=q(n,t.conv2,"valid"),n=Tt(n,t.prelu2_alpha),n=e?n:R(n,[3,3],[2,2],"valid"),n=q(n,t.conv3,"valid"),n=Tt(n,t.prelu3_alpha),n})}function Wa(r,t){return F(function(){var e=Re(r,t,!0),n=q(e,t.conv4_1,"valid"),a=Zt(ge(n,3),3),o=At(J(n,a),3),c=q(e,t.conv4_2,"valid");return{prob:o,regions:c}})}function Ra(r,t){return F(function(){var e=de(t,r.shape.slice(1)),n=e.height,a=e.width,o=ir.resizeBilinear(r,[n,a]),c=Jr(o);return Pt(c,[0,2,1,3])})}function ja(r,t,e,n){for(var a=[],o=r.arraySync(),c=0;c<r.shape[0];c++)for(var i=0;i<r.shape[1];i++)o[c][i]>=n&&a.push(new C(i,c));var s=a.map(function(u){var h=new te(Math.round((u.y*Yt+1)/e),Math.round((u.x*Yt+1)/e),Math.round((u.y*Yt+Xt)/e),Math.round((u.x*Yt+Xt)/e)),f=o[u.y][u.x],v=t.arraySync(),l=new We(v[u.y][u.x][0],v[u.y][u.x][1],v[u.y][u.x][2],v[u.y][u.x][3]);return{cell:h,score:f,region:l}});return s}function za(r,t,e,n,a){a.stage1=[];var o=t.map(function(v){return F(function(){var l={scale:v},p=Ra(r,v),m=Date.now(),g=Wa(p,n),b=g.prob,P=g.regions;l.pnet=Date.now()-m;var x=z(z(b,3)[1])[0],d=z(P)[0];return{scoresTensor:x,regionsTensor:d,scale:v,statsForScale:l}})}),c=o.map(function(v){var l=v.scoresTensor,p=v.regionsTensor,m=v.scale,g=v.statsForScale,b=ja(l,p,m,e);if(l.dispose(),p.dispose(),!b.length)return a.stage1.push(g),[];var P=Date.now(),x=It(b.map(function(d){return d.cell}),b.map(function(d){return d.score}),.5);return g.nms=Date.now()-P,g.numBoxes=x.length,a.stage1.push(g),x.map(function(d){return b[d]})}),i=c.reduce(function(v,l){return v.concat(l)},[]),s=[],u=[];if(i.length>0){var h=Date.now(),f=It(i.map(function(v){return v.cell}),i.map(function(v){return v.score}),.7);a.stage1_nms=Date.now()-h,u=f.map(function(v){return i[v].score}),s=f.map(function(v){return i[v]}).map(function(v){var l=v.cell,p=v.region;return new te(l.left+p.left*l.width,l.top+p.top*l.height,l.right+p.right*l.width,l.bottom+p.bottom*l.height).toSquare().round()})}return{boxes:s,scores:u}}function Xr(r,t,e){var n=e.width,a=e.height;return y(this,void 0,void 0,function(){var o,c,i,s=this;return w(this,function(u){switch(u.label){case 0:return o=rt(r),[4,Promise.all(t.map(function(h){return y(s,void 0,void 0,function(){var f,v,l,p,m,g,b,P;return w(this,function(x){return f=h.padAtBorders(r.height,r.width),v=f.y,l=f.ey,p=f.x,m=f.ex,g=p-1,b=v-1,P=o.getImageData(g,b,m-g,l-b),[2,j.isNodejs()?Fe(P):createImageBitmap(P)]})})}))];case 1:return c=u.sent(),i=[],c.forEach(function(h){var f=ee({width:n,height:a}),v=rt(f);v.drawImage(h,0,0,n,a);for(var l=v.getImageData(0,0,n,a).data,p=[],m=0;m<l.length;m+=4)p.push(l[m+2]),p.push(l[m+1]),p.push(l[m]);i.push(p)}),[2,i.map(function(h){var f=F(function(){var v=Pt(xt(h,[1,n,a,3]),[0,2,1,3]).toFloat();return Jr(v)});return f})]}})})}function Ha(r,t){return F(function(){var e=Re(r,t),n=mt(e,[e.shape[0],t.fc1.weights.shape[0]]),a=tt(n,t.fc1),o=Tt(a,t.prelu4_alpha),c=tt(o,t.fc2_1),i=Zt(ge(c,1),1),s=At(J(c,i),1),u=tt(o,t.fc2_2),h=z(s,1)[1];return{scores:h,regions:u}})}function Ga(r,t,e,n,a){return y(this,void 0,void 0,function(){var o,c,i,s,u,h,f,v,l,p,m,g,b,P;return w(this,function(x){switch(x.label){case 0:return o=Date.now(),[4,Xr(r,t,{width:24,height:24})];case 1:return c=x.sent(),a.stage2_extractImagePatches=Date.now()-o,o=Date.now(),i=c.map(function(d){var _=Ha(d,n);return d.dispose(),_}),a.stage2_rnet=Date.now()-o,s=i.length>1?it(i.map(function(d){return d.scores})):i[0].scores,f=(h=Array).from,[4,s.data()];case 2:return u=f.apply(h,[x.sent()]),s.dispose(),v=u.map(function(d,_){return{score:d,idx:_}}).filter(function(d){return d.score>e}).map(function(d){var _=d.idx;return _}),l=v.map(function(d){return t[d]}),p=v.map(function(d){return u[d]}),m=[],g=[],l.length>0&&(o=Date.now(),b=It(l,p,.7),a.stage2_nms=Date.now()-o,P=b.map(function(d){var _=i[v[d]].regions.arraySync();return new We(_[0][0],_[0][1],_[0][2],_[0][3])}),g=b.map(function(d){return p[d]}),m=b.map(function(d,_){return l[d].calibrate(P[_])})),i.forEach(function(d){d.regions.dispose(),d.scores.dispose()}),[2,{boxes:m,scores:g}]}})})}function Va(r,t){return F(function(){var e=Re(r,t);e=R(e,[2,2],[2,2],"same"),e=q(e,t.conv4,"valid"),e=Tt(e,t.prelu4_alpha);var n=mt(e,[e.shape[0],t.fc1.weights.shape[0]]),a=tt(n,t.fc1),o=Tt(a,t.prelu5_alpha),c=tt(o,t.fc2_1),i=Zt(ge(c,1),1),s=At(J(c,i),1),u=tt(o,t.fc2_2),h=tt(o,t.fc2_3),f=z(s,1)[1];return{scores:f,regions:u,points:h}})}function $a(r,t,e,n,a){return y(this,void 0,void 0,function(){var o,c,i,s,u,h,f,v,l,p,m,g,b,P,x;return w(this,function(d){switch(d.label){case 0:return o=Date.now(),[4,Xr(r,t,{width:48,height:48})];case 1:return c=d.sent(),a.stage3_extractImagePatches=Date.now()-o,o=Date.now(),i=c.map(function(_){var M=Va(_,n);return _.dispose(),M}),a.stage3_onet=Date.now()-o,s=i.length>1?it(i.map(function(_){return _.scores})):i[0].scores,f=(h=Array).from,[4,s.data()];case 2:return u=f.apply(h,[d.sent()]),s.dispose(),v=u.map(function(_,M){return{score:_,idx:M}}).filter(function(_){return _.score>e}).map(function(_){var M=_.idx;return M}),l=v.map(function(_){var M=i[_].regions.arraySync();return new We(M[0][0],M[0][1],M[0][2],M[0][3])}),p=v.map(function(_,M){return t[_].calibrate(l[M])}),m=v.map(function(_){return u[_]}),g=[],b=[],P=[],p.length>0&&(o=Date.now(),x=It(p,m,.7,!1),a.stage3_nms=Date.now()-o,g=x.map(function(_){return p[_]}),b=x.map(function(_){return m[_]}),P=x.map(function(_,M){return Array(5).fill(0).map(function(k,L){var A=i[_].points.arraySync();return new C(A[0][L]*(g[M].width+1)+g[M].left,A[0][L+5]*(g[M].height+1)+g[M].top)})})),i.forEach(function(_){_.regions.dispose(),_.scores.dispose(),_.points.dispose()}),[2,{boxes:g,scores:b,points:P}]}})})}var qr=(function(r){E(t,r);function t(){return r.call(this,"Mtcnn")||this}return t.prototype.load=function(e){return y(this,void 0,void 0,function(){return w(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.load.call(this,e)]})})},t.prototype.loadFromDisk=function(e){return y(this,void 0,void 0,function(){return w(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,r.prototype.loadFromDisk.call(this,e)]})})},t.prototype.forwardInput=function(e,n){return n===void 0&&(n={}),y(this,void 0,void 0,function(){var a,o,c,i,s,u,h,f,v,l,p,m,g,b,P,x,d,_,M,k,L;return w(this,function(A){switch(A.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(o=e.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return c={},i=Date.now(),s=F(function(){return Aa(Zt(me.fromPixels(o)).toFloat())}),u=function(D){return s.dispose(),c.total=Date.now()-i,D},h=s.shape.slice(1),f=h[0],v=h[1],l=new Le(n),p=l.minFaceSize,m=l.scaleFactor,g=l.maxNumScales,b=l.scoreThresholds,P=l.scaleSteps,x=(P||Oa(p,m,[f,v])).filter(function(D){var O=de(D,[f,v]);return Math.min(O.width,O.height)>Xt}).slice(0,g),c.scales=x,c.pyramid=x.map(function(D){return de(D,[f,v])}),d=Date.now(),[4,za(s,x,b[0],a.pnet,c)];case 1:return _=A.sent(),c.total_stage1=Date.now()-d,_.boxes.length?(c.stage2_numInputBoxes=_.boxes.length,d=Date.now(),[4,Ga(o,_.boxes,b[1],a.rnet,c)]):[2,u({results:[],stats:c})];case 2:return M=A.sent(),c.total_stage2=Date.now()-d,M.boxes.length?(c.stage3_numInputBoxes=M.boxes.length,d=Date.now(),[4,$a(o,M.boxes,b[2],a.onet,c)]):[2,u({results:[],stats:c})];case 3:return k=A.sent(),c.total_stage3=Date.now()-d,L=k.boxes.map(function(D,O){return ne(Wt({},new Y(k.scores[O],new _e(D.left/v,D.top/f,D.width/v,D.height/f),{height:f,width:v})),new xn(k.points[O].map(function(H){return H.sub(new C(D.left,D.top)).div(new C(D.width,D.height))}),{width:D.width,height:D.height}))}),[2,u({results:L,stats:c})]}})})},t.prototype.forward=function(e,n){return n===void 0&&(n={}),y(this,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,W(e)];case 1:return[4,a.apply(this,[o.sent(),n])];case 2:return[2,o.sent().results]}})})},t.prototype.forwardWithStats=function(e,n){return n===void 0&&(n={}),y(this,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,W(e)];case 1:return[2,a.apply(this,[o.sent(),n])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Ia(e)},t.prototype.extractParams=function(e){return La(e)},t})(ut),Ya=.4,Ua=[new C(1.603231,2.094468),new C(6.041143,7.080126),new C(2.882459,3.518061),new C(4.266906,5.178857),new C(9.041765,10.66308)],Ja=[117.001,114.697,97.404],Zr=(function(r){E(t,r);function t(){var e=this,n={withSeparableConvs:!0,iouThreshold:Ya,classes:["face"],anchors:Ua,meanRgb:Ja,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=r.call(this,n)||this,e}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,n){return y(this,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return[4,this.detect(e,n)];case 1:return a=o.sent(),[2,a.map(function(c){return new Y(c.score,c.relativeBox,{width:c.imageWidth,height:c.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return r.prototype.extractParamsFromWeigthMap.call(this,e)},t})(Yr),S={ssdMobilenetv1:new Ne,tinyFaceDetector:new Zr,tinyYolov2:new Ur,mtcnn:new qr,faceLandmark68Net:new Rr,faceLandmark68TinyNet:new Kn,faceRecognitionNet:new Hr,faceExpressionNet:new In,ageGenderNet:new Jn},Xa=function(r,t){return S.ssdMobilenetv1.locateFaces(r,t)},xo=function(r,t){return S.tinyFaceDetector.locateFaces(r,t)},Po=function(r,t){return S.tinyYolov2.locateFaces(r,t)},Fo=function(r,t){return S.mtcnn.forward(r,t)},qa=function(r){return S.faceLandmark68Net.detectLandmarks(r)},Eo=function(r){return S.faceLandmark68TinyNet.detectLandmarks(r)},Mo=function(r){return S.faceRecognitionNet.computeFaceDescriptor(r)},Do=function(r){return S.faceExpressionNet.predictExpressions(r)},To=function(r){return S.ageGenderNet.predictAgeAndGender(r)},Za=function(r){return S.ssdMobilenetv1.load(r)},Co=function(r){return S.tinyFaceDetector.load(r)},So=function(r){return S.mtcnn.load(r)},ko=function(r){return S.tinyYolov2.load(r)},Ao=function(r){return S.faceLandmark68Net.load(r)},Bo=function(r){return S.faceLandmark68TinyNet.load(r)},Lo=function(r){return S.faceRecognitionNet.load(r)},No=function(r){return S.faceExpressionNet.load(r)},Io=function(r){return S.ageGenderNet.load(r)},Oo=Za,Wo=Xa,Ro=qa,Kr=(function(r){E(t,r);function t(e,n,a){var o=r.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=a,o}return t})(zt),je=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n,a=this;return w(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,oe(e,this.input,function(c){return y(a,void 0,void 0,function(){return w(this,function(i){switch(i.label){case 0:return[4,Promise.all(c.map(function(s){return S.faceExpressionNet.predictExpressions(s)}))];case 1:return[2,i.sent()]}})})},this.extractedFaces)];case 2:return n=o.sent(),[2,e.map(function(c,i){return Lr(c,n[i])})]}})})},t.prototype.withAgeAndGender=function(){return new Ve(this,this.input)},t})(Kr),ze=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n;return w(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,Oe(e,this.input,function(o){return S.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return n=a.sent(),[2,Lr(e,n)]}})})},t.prototype.withAgeAndGender=function(){return new $e(this,this.input)},t})(Kr),He=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Ye(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Je(this,this.input)},t})(je),Ge=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Ue(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Xe(this,this.input)},t})(ze),Qr=(function(r){E(t,r);function t(e,n,a){var o=r.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=a,o}return t})(zt),Ve=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n,a=this;return w(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,oe(e,this.input,function(c){return y(a,void 0,void 0,function(){return w(this,function(i){switch(i.label){case 0:return[4,Promise.all(c.map(function(s){return S.ageGenderNet.predictAgeAndGender(s)}))];case 1:return[2,i.sent()]}})})},this.extractedFaces)];case 2:return n=o.sent(),[2,e.map(function(c,i){var s=n[i],u=s.age,h=s.gender,f=s.genderProbability;return Vr($r(c,h,f),u)})]}})})},t.prototype.withFaceExpressions=function(){return new je(this,this.input)},t})(Qr),$e=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n,a,o,c;return w(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),e?[4,Oe(e,this.input,function(s){return S.ageGenderNet.predictAgeAndGender(s)},this.extractedFaces)]:[2];case 2:return n=i.sent(),a=n.age,o=n.gender,c=n.genderProbability,[2,Vr($r(e,o,c),a)]}})})},t.prototype.withFaceExpressions=function(){return new ze(this,this.input)},t})(Qr),Ye=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new He(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Je(this,this.input)},t})(Ve),Ue=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new Ge(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Xe(this,this.input)},t})($e),tn=(function(r){E(t,r);function t(e,n){var a=r.call(this)||this;return a.parentTask=e,a.input=n,a}return t})(zt),Je=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n;return w(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,oe(e,this.input,function(o){return Promise.all(o.map(function(c){return S.faceRecognitionNet.computeFaceDescriptor(c)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=a.sent(),[2,n.map(function(o,c){return Gr(e[c],o)})]}})})},t.prototype.withFaceExpressions=function(){return new He(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ye(this,this.input)},t})(tn),Xe=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n;return w(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,Oe(e,this.input,function(o){return S.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=a.sent(),[2,Gr(e,n)]}})})},t.prototype.withFaceExpressions=function(){return new Ge(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ue(this,this.input)},t})(tn),en=(function(r){E(t,r);function t(e,n,a){var o=r.call(this)||this;return o.parentTask=e,o.input=n,o.useTinyLandmarkNet=a,o}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?S.faceLandmark68TinyNet:S.faceLandmark68Net},enumerable:!0,configurable:!0}),t})(zt),Ka=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n,a,o,c,i=this;return w(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),n=e.map(function(u){return u.detection}),this.input instanceof st?[4,Me(this.input,n)]:[3,3];case 2:return o=s.sent(),[3,5];case 3:return[4,Ee(this.input,n)];case 4:o=s.sent(),s.label=5;case 5:return a=o,[4,Promise.all(a.map(function(u){return i.landmarkNet.detectLandmarks(u)}))];case 6:return c=s.sent(),a.forEach(function(u){return u instanceof st&&u.dispose()}),[2,e.map(function(u,h){return ne(u,c[h])})]}})})},t.prototype.withFaceExpressions=function(){return new He(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ye(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Je(this,this.input)},t})(en),Qa=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n,a,o,c;return w(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return e=i.sent(),e?(n=e.detection,this.input instanceof st?[4,Me(this.input,[n])]:[3,3]):[2];case 2:return o=i.sent(),[3,5];case 3:return[4,Ee(this.input,[n])];case 4:o=i.sent(),i.label=5;case 5:return a=o,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return c=i.sent(),a.forEach(function(s){return s instanceof st&&s.dispose()}),[2,ne(e,c)]}})})},t.prototype.withFaceExpressions=function(){return new Ge(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ue(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Xe(this,this.input)},t})(en),rn=(function(r){E(t,r);function t(e,n){n===void 0&&(n=new Lt);var a=r.call(this)||this;return a.input=e,a.options=n,a}return t})(zt),nn=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n,a,o;return w(this,function(c){switch(c.label){case 0:return e=this,n=e.input,a=e.options,a instanceof Le?[4,S.mtcnn.forward(n,a)]:[3,2];case 1:return[2,c.sent().map(function(i){return i.detection})];case 2:if(o=a instanceof ka?function(i){return S.tinyFaceDetector.locateFaces(i,a)}:a instanceof Lt?function(i){return S.ssdMobilenetv1.locateFaces(i,a)}:a instanceof ae?function(i){return S.tinyYolov2.locateFaces(i,a)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(n)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(n){return y(e,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return a=o.sent(),[2,n(a.map(function(c){return Wt({},c)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Ka(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new je(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Ve(this.runAndExtendWithFaceDetections(),this.input)},t})(rn),to=(function(r){E(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.run=function(){return y(this,void 0,void 0,function(){var e,n;return w(this,function(a){switch(a.label){case 0:return[4,new nn(this.input,this.options)];case 1:return e=a.sent(),n=e[0],e.forEach(function(o){o.score>n.score&&(n=o)}),[2,n]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(n){return y(e,void 0,void 0,function(){var a;return w(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return a=o.sent(),[2,n(a?Wt({},a):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new Qa(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new ze(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new $e(this.runAndExtendWithFaceDetection(),this.input)},t})(rn);function jo(r,t){return t===void 0&&(t=new Lt),new to(r,t)}function qe(r,t){return t===void 0&&(t=new Lt),new nn(r,t)}function eo(r,t){return y(this,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return console.warn("allFacesSsdMobilenetv1 is deprecated and will be removed soon, use the high level api instead"),[4,qe(r,new Lt(t?{minConfidence:t}:{})).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,e.sent()]}})})}function zo(r,t){return t===void 0&&(t={}),y(this,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return console.warn("allFacesTinyYolov2 is deprecated and will be removed soon, use the high level api instead"),[4,qe(r,new ae(t)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,e.sent()]}})})}function Ho(r,t){return t===void 0&&(t={}),y(this,void 0,void 0,function(){return w(this,function(e){switch(e.label){case 0:return console.warn("allFacesMtcnn is deprecated and will be removed soon, use the high level api instead"),[4,qe(r,new Le(t)).withFaceLandmarks().withFaceDescriptors()];case 1:return[2,e.sent()]}})})}var Go=eo;function ro(r,t){if(r.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(r),n=Array.from(t);return Math.sqrt(e.map(function(a,o){return a-n[o]}).reduce(function(a,o){return a+Math.pow(o,2)},0))}var Vo=(function(){function r(t,e){e===void 0&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,o=function(){return"person "+a++};this._labeledDescriptors=n.map(function(c){if(c instanceof Ht)return c;if(c instanceof Float32Array)return new Ht(o(),[c]);if(c.descriptor&&c.descriptor instanceof Float32Array)return new Ht(o(),[c.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(t,e){return e.map(function(n){return ro(n,t)}).reduce(function(n,a){return n+a},0)/(e.length||1)},r.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var a=n.descriptors,o=n.label;return new er(o,e.computeMeanDistance(t,a))}).reduce(function(n,a){return n.distance<a.distance?n:a})},r.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new er("unknown",e.distance)},r.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},r.fromJSON=function(t){var e=t.labeledDescriptors.map(function(n){return Ht.fromJSON(n)});return new r(e,t.distanceThreshold)},r})();function $o(r){var t=new qr;return t.extractWeights(r),t}function Yo(r){var t=new Zr;return t.extractWeights(r),t}function no(r,t){var e=new wt(t.width,t.height),n=e.width,a=e.height;if(n<=0||a<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:n,height:a}));if(Array.isArray(r))return r.map(function(i){return no(i,{width:n,height:a})});if(Ae(r)){var o=r.detection.forSize(n,a),c=r.unshiftedLandmarks.forSize(o.box.width,o.box.height);return ne(Wt(r,o),c)}return Ot(r)?Wt(r,r.detection.forSize(n,a)):r instanceof St||r instanceof Y?r.forSize(n,a):r}export{Jn as AgeGenderNet,te as BoundingBox,et as Box,zt as ComposableTask,Je as ComputeAllFaceDescriptorsTask,tn as ComputeFaceDescriptorsTaskBase,Xe as ComputeSingleFaceDescriptorTask,Ka as DetectAllFaceLandmarksTask,nn as DetectAllFacesTask,en as DetectFaceLandmarksTaskBase,rn as DetectFacesTaskBase,Qa as DetectSingleFaceLandmarksTask,to as DetectSingleFaceTask,wt as Dimensions,ar as FACE_EXPRESSION_LABELS,Y as FaceDetection,yo as FaceDetectionNet,In as FaceExpressionNet,ke as FaceExpressions,Rr as FaceLandmark68Net,Kn as FaceLandmark68TinyNet,po as FaceLandmarkNet,St as FaceLandmarks,xn as FaceLandmarks5,gr as FaceLandmarks68,er as FaceMatch,Vo as FaceMatcher,Hr as FaceRecognitionNet,kt as Gender,rr as LabeledBox,Ht as LabeledFaceDescriptors,qr as Mtcnn,Le as MtcnnOptions,Jt as NetInput,ut as NeuralNetwork,mr as ObjectDetection,C as Point,uo as PredictedBox,_e as Rect,Ne as SsdMobilenetv1,Lt as SsdMobilenetv1Options,Zr as TinyFaceDetector,ka as TinyFaceDetectorOptions,Ur as TinyYolov2,ae as TinyYolov2Options,or as TinyYolov2SizeType,Go as allFaces,Ho as allFacesMtcnn,eo as allFacesSsdMobilenetv1,zo as allFacesTinyYolov2,Mn as awaitMediaLoaded,Dn as bufferToImage,Mo as computeFaceDescriptor,ee as createCanvas,Fe as createCanvasFromMedia,bo as createFaceDetectionNet,mo as createFaceRecognitionNet,$o as createMtcnn,ba as createSsdMobilenetv1,Yo as createTinyFaceDetector,wo as createTinyYolov2,qe as detectAllFaces,qa as detectFaceLandmarks,Eo as detectFaceLandmarksTiny,Ro as detectLandmarks,jo as detectSingleFace,lo as draw,j as env,ro as euclideanDistance,Vr as extendWithAge,Gr as extendWithFaceDescriptor,Wt as extendWithFaceDetection,Lr as extendWithFaceExpressions,ne as extendWithFaceLandmarks,$r as extendWithGender,Me as extractFaceTensors,Ee as extractFaces,ho as fetchImage,Sn as fetchJson,fo as fetchNetWeights,De as fetchOrThrow,rt as getContext2dOrThrow,Pe as getMediaDimensions,Tn as imageTensorToCanvas,Cn as imageToSquare,so as inverseSigmoid,mn as iou,nr as isMediaElement,Er as isMediaLoaded,go as isWithAge,Ot as isWithFaceDetection,On as isWithFaceExpressions,Ae as isWithFaceLandmarks,_o as isWithGender,Io as loadAgeGenderModel,Oo as loadFaceDetectionModel,No as loadFaceExpressionModel,Ao as loadFaceLandmarkModel,Bo as loadFaceLandmarkTinyModel,Lo as loadFaceRecognitionModel,So as loadMtcnnModel,Za as loadSsdMobilenetv1Model,Co as loadTinyFaceDetectorModel,ko as loadTinyYolov2Model,kn as loadWeightMap,Wo as locateFaces,vo as matchDimensions,gn as minBbox,Fo as mtcnn,S as nets,It as nonMaxSuppression,jt as normalize,_n as padToSquare,To as predictAgeAndGender,Do as recognizeFaceExpressions,no as resizeResults,ye as resolveInput,co as shuffleArray,ue as sigmoid,Xa as ssdMobilenetv1,Xo as tf,xo as tinyFaceDetector,Po as tinyYolov2,W as toNetInput,io as utils,Ma as validateConfig};
